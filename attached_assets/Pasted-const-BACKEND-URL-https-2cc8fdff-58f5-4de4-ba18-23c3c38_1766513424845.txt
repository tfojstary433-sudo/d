const BACKEND_URL = 'https://2cc8fdff-58f5-4de4-ba18-23c3c389e63d-00-10zd3s5b89sgn.janeway.replit.dev';
const LOCAL_API = 'http://localhost:3000';
const CORS_PROXY = 'https://api.codetabs.com/v1/proxy?quest=';

async function fetchApi(endpoint) {
    try {
        const url = `${BACKEND_URL}${endpoint}`;
        const corsUrl = `${CORS_PROXY}${encodeURIComponent(url)}`;
        console.log('Fetching:', url);
        const response = await fetch(corsUrl);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
    } catch (error) {
        console.error('API Error:', error);
        return [];
    }
}
let pollInterval = null;
let lastValidMatchData = null;
let previousTeamAScore = null;
let previousTeamBScore = null;
let matchGoals = [];
let currentMatchTeamA = null;
let currentMatchTeamB = null;

function loadStoredMatchData() {
    const storedGoals = localStorage.getItem('matchGoals');
    const storedTeamA = localStorage.getItem('currentMatchTeamA');
    const storedTeamB = localStorage.getItem('currentMatchTeamB');
    const storedMatchData = localStorage.getItem('lastValidMatchData');
    const storedEvents = localStorage.getItem('matchEvents');
    
    if (storedGoals) {
        matchGoals = JSON.parse(storedGoals);
    }
    if (storedTeamA) {
        currentMatchTeamA = JSON.parse(storedTeamA);
    }
    if (storedTeamB) {
        currentMatchTeamB = JSON.parse(storedTeamB);
    }
    if (storedMatchData) {
        lastValidMatchData = JSON.parse(storedMatchData);
    }
    if (storedEvents && lastValidMatchData) {
        lastValidMatchData.events = JSON.parse(storedEvents);
    }
}

const teamFlags = {
    'POLSKA': 'https://flagcdn.com/w320/pl.png',
    'NIEMCY': 'https://flagcdn.com/w320/de.png',
    'FRANCJA': 'https://flagcdn.com/w320/fr.png',
    'ANGLIA': 'https://flagcdn.com/w320/gb.png',
    'W≈ÅOCHY': 'https://flagcdn.com/w320/it.png',
    'HISZPANIA': 'https://flagcdn.com/w320/es.png',
    'PORTUGAL': 'https://flagcdn.com/w320/pt.png',
    'HOLANDIA': 'https://flagcdn.com/w320/nl.png',
    'BELGIA': 'https://flagcdn.com/w320/be.png',
    'CZECHY': 'https://flagcdn.com/w320/cz.png',
    'S≈ÅOWACJA': 'https://flagcdn.com/w320/sk.png',
    'UKRAINA': 'https://flagcdn.com/w320/ua.png',
    'RUMUNIA': 'https://flagcdn.com/w320/ro.png',
    'BU≈ÅGARIA': 'https://flagcdn.com/w320/bg.png',
    'WƒòGRY': 'https://flagcdn.com/w320/hu.png',
    'AUSTRIA': 'https://flagcdn.com/w320/at.png',
    'SZWAJCARIA': 'https://flagcdn.com/w320/ch.png',
    'BELGIA': 'https://flagcdn.com/w320/be.png',
    'DANIA': 'https://flagcdn.com/w320/dk.png',
    'NORWEGIA': 'https://flagcdn.com/w320/no.png',
    'SZWECJA': 'https://flagcdn.com/w320/se.png',
    'FINLANDIA': 'https://flagcdn.com/w320/fi.png',
    'ISLANDIA': 'https://flagcdn.com/w320/is.png',
    'GRECJA': 'https://flagcdn.com/w320/gr.png',
    'TURCJA': 'https://flagcdn.com/w320/tr.png',
    'ROSJA': 'https://flagcdn.com/w320/ru.png'
};

function getCountryFlag(teamName) {
    const upperName = teamName.toUpperCase();
    return teamFlags[upperName] || 'https://via.placeholder.com/60x40?text=?';
}

function roundTimeToMinute(timeStr) {
    if (!timeStr && timeStr !== 0) return '0';
    
    const timeString = String(timeStr);
    
    if (!timeString.includes(':')) {
        return timeString;
    }
    
    const parts = timeString.split(':');
    if (parts.length < 2) return timeString;
    const minutes = parseInt(parts[0]) || 0;
    const seconds = parseInt(parts[1]) || 0;
    const rounded = seconds > 0 ? minutes + 1 : minutes;
    return String(rounded);
}

function playGoalAnimation(teamLetter, matchData) {
    const matchBox = document.getElementById('live-match-box');
    if (!matchBox) return;
    
    const teamName = teamLetter === 'A' ? matchData.teamA.nazwa : matchData.teamB.nazwa;
    const score = teamLetter === 'A' ? matchData.teamA.score : matchData.teamB.score;
    const oppScore = teamLetter === 'A' ? matchData.teamB.score : matchData.teamA.score;
    
    const goalData = {
        team: teamName,
        minute: matchData.timer,
        score: `${teamLetter === 'A' ? score : oppScore} - ${teamLetter === 'B' ? score : oppScore}`,
        teamLetter: teamLetter,
        timestamp: new Date()
    };
    
    matchGoals.push(goalData);
    localStorage.setItem('matchGoals', JSON.stringify(matchGoals));
    
    const goalOverlay = document.createElement('div');
    goalOverlay.style.position = 'absolute';
    goalOverlay.style.top = '0';
    goalOverlay.style.left = '0';
    goalOverlay.style.right = '0';
    goalOverlay.style.bottom = '0';
    goalOverlay.style.pointerEvents = 'none';
    goalOverlay.style.zIndex = '0';
    goalOverlay.style.overflow = 'hidden';
    goalOverlay.style.background = 'transparent';
    
    const goalContainer = document.createElement('div');
    goalContainer.style.position = 'absolute';
    goalContainer.style.top = '50%';
    goalContainer.style.left = '0';
    goalContainer.style.width = '100%';
    goalContainer.style.transform = 'translateY(-50%)';
    goalContainer.style.display = 'flex';
    goalContainer.style.flexDirection = 'column';
    goalContainer.style.justifyContent = 'center';
    goalContainer.style.alignItems = 'center';
    goalContainer.style.animation = 'cascadeGoal 1.5s ease-out forwards';
    
    const rowCount = 2;
    const colCount = 12;
    
    for (let row = 0; row < rowCount; row++) {
        const rowDiv = document.createElement('div');
        rowDiv.style.display = 'flex';
        rowDiv.style.gap = '5px';
        
        for (let col = 0; col < colCount; col++) {
            const delay = (row + col) * 0.08;
            const golText = document.createElement('span');
            golText.textContent = 'GOL';
            golText.style.fontSize = '2.5rem';
            golText.style.fontWeight = '900';
            golText.style.color = 'rgba(255, 255, 255, 0.6)';
            golText.style.fontFamily = '"Arial Black", sans-serif';
            golText.style.textShadow = '0 0 10px rgba(255, 255, 255, 0.4)';
            golText.style.opacity = '0';
            golText.style.animation = `popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards`;
            golText.style.animationDelay = `${delay}s`;
            golText.style.letterSpacing = '2px';
            
            rowDiv.appendChild(golText);
        }
        
        goalContainer.appendChild(rowDiv);
    }
    
    goalOverlay.appendChild(goalContainer);
    matchBox.appendChild(goalOverlay);
    
    const timeoutId1 = setTimeout(() => {
        const allGolTexts = goalOverlay.querySelectorAll('span');
        allGolTexts.forEach((text, index) => {
            setTimeout(() => {
                text.style.animation = 'popOut 0.3s ease-in forwards';
            }, index * 15);
        });
    }, 800);
    
    const timeoutId2 = setTimeout(() => {
        if (goalOverlay && goalOverlay.parentNode) {
            goalOverlay.remove();
        }
    }, 1600);
}

function updateLiveMatches(allMatches) {
    console.log('[UPDATE] Matches to display:', allMatches.length);
    const liveContainer = document.getElementById('live-match-container');
    if (!liveContainer) return;
    
    if (!allMatches || allMatches.length === 0) {
        liveContainer.innerHTML = '<div style="color: #888; text-align: center; padding: 1rem;">Brak aktywnych mecz√≥w</div>';
        return;
    }
    
    allMatches.forEach((match, idx) => {
        if (idx === 0) {
            localStorage.setItem('lastValidMatchData', JSON.stringify(match));
        }
    });
    
    allLiveMatches = allMatches;
    
    const matchDetailView = document.getElementById('match-detail-view');
    const isDetailOpen = matchDetailView && matchDetailView.style.display !== 'none';
    
    let html = '';
    allMatches.forEach((match, idx) => {
        const logoA = getTeamLogo(match.teamA.nazwa);
        const logoB = getTeamLogo(match.teamB.nazwa);
        
        let goalsHtml = '';
        if (match.events && match.events.goals && Array.isArray(match.events.goals)) {
            match.events.goals.forEach(goal => {
                goalsHtml += `<div style="color: #aaa; font-size: 0.9rem; margin-top: 0.3rem;">${goal.player || 'Gracz'} ${goal.minute || '?'}'</div>`;
            });
        }
        
        let substitutionsHtml = '';
        if (match.events && match.events.substitutions && Array.isArray(match.events.substitutions)) {
            match.events.substitutions.slice(0, 3).forEach(sub => {
                substitutionsHtml += `<div style="color: #666; font-size: 0.85rem; margin-top: 0.2rem;">${sub.playerOut || 'Gracz'} ‚Üí ${sub.playerIn || 'Gracz'} ${sub.minute || '?'}'</div>`;
            });
        }
        
        html += `
        <div class="live-match-card" onclick="selectMatchAndOpenDetail(${idx})">
            <div class="live-match-background"></div>
            
            <div class="live-match-header">
                <div class="live-match-team">
                    <img src="${logoA}" class="live-match-logo">
                    <span class="live-match-team-name">${match.teamA.nazwa}</span>
                </div>
                <div class="live-match-status">
                    KONIEC
                </div>
                <div class="live-match-team">
                    <span class="live-match-team-name">${match.teamB.nazwa}</span>
                    <img src="${logoB}" class="live-match-logo">
                </div>
            </div>
            
            <div class="live-match-score">
                <div class="live-match-score-value">${match.teamA.score}:${match.teamB.score}</div>
            </div>
            
            <div class="live-match-events">
                <div class="live-match-goals">
                    ${goalsHtml || '<div style="color: #666; font-size: 0.9rem;">Brak bramek</div>'}
                </div>
                ${substitutionsHtml ? `<div class="live-match-subs" style="margin-top: 0.8rem; border-top: 1px solid #333; padding-top: 0.5rem;">${substitutionsHtml}</div>` : ''}
            </div>
            
            <div class="live-match-footer">
                <div style="color: #888; font-size: 0.85rem;">${match.period} | ${match.timer}</div>
            </div>
        </div>`;
    });
    
    liveContainer.innerHTML = html;
    
    if (allMatches.length > 0) {
        if (isDetailOpen) {
            const selectedMatch = allMatches[selectedMatchIndex];
            if (selectedMatch) {
                lastValidMatchData = selectedMatch;
                currentMatchTeamA = selectedMatch.teamA;
                currentMatchTeamB = selectedMatch.teamB;
                updateMatchDetailPage();
            }
        } else {
            selectedMatchIndex = 0;
            updateMatchDetailPage();
        }
    }
}

function getTeamLogo(teamName) {
    const team = druzyny.find(d => d.nazwa === teamName || d.skrot === teamName);
    return team ? team.logo : 'https://via.placeholder.com/40?text=?';
}

function getTeamShortcut(teamName) {
    const team = druzyny.find(d => d.nazwa === teamName || d.skrot === teamName);
    return team ? team.skrot : '?';
}

function pollMatchStatus() {
    console.log('[POLL] Fetching from:', BACKEND_URL);
    fetchApi('/api/matches?t=' + Date.now())
        .then(data => {
            console.log('[POLL] Otrzymane dane z API:', data);
            
            let activeMatches = [];
            
            if (Array.isArray(data)) {
                console.log('[POLL] API zwraca tablicƒô - szukam wszystkich aktywnych mecz√≥w...');
                activeMatches = data.filter(m => m.isActive === true || m.status === 'active');
                console.log('[POLL] Znaleziono aktywnych mecz√≥w:', activeMatches.length);
                console.log('[POLL] Znalezione mecze:', activeMatches);
            } else if (data && (data.isActive === true || data.status === 'active')) {
                activeMatches = [data];
                console.log('[POLL] Znaleziono pojedynczy aktywny mecz');
            }
            
            if (activeMatches.length === 0) {
                console.log('[POLL] Brak aktywnych mecz√≥w');
                if (lastValidMatchData && lastValidMatchData.active) {
                    setTimeout(fetchLeagueTable, 1000);
                }
                lastValidMatchData = null;
                clearLiveMatch();
                return;
            }
            
            activeMatches = activeMatches.map(m => {
                console.log('[POLL] Przetwarzam mecz:', m);
                let goals = [];
                let substitutions = [];
                let cards = [];
                let lineup = null;
                
                if (m.events) {
                    if (Array.isArray(m.events)) {
                        goals = m.events.filter(e => e.type === 'goal' || e.type === 'Goal');
                        substitutions = m.events.filter(e => e.type === 'substitution' || e.type === 'Substitution');
                        cards = m.events.filter(e => e.type === 'yellowcard' || e.type === 'redcard' || e.type === 'card' || e.type === 'Card' || e.type === 'YellowCard' || e.type === 'RedCard');
                        const lineupEvent = m.events.find(e => e.type === 'lineup' || e.type === 'Lineup');
                        if (lineupEvent) lineup = lineupEvent;
                    } else {
                        console.log('[POLL] Events jest obiektem - ekstrakcja p√≥l...');
                        goals = m.events.goals || m.events.Goals || [];
                        substitutions = m.events.substitutions || m.events.Substitutions || [];
                        cards = m.events.cards || m.events.Cards || [];
                        lineup = m.events.lineup || m.events.Lineup || null;
                    }
                }
                
                console.log('[POLL] Wyekstrahowano:', { goals: goals.length, substitutions: substitutions.length, cards: cards.length });
                
                return {
                    active: m.isActive || m.status === 'active',
                    teamA: { nazwa: m.teamA, score: m.scoreA || 0 },
                    teamB: { nazwa: m.teamB, score: m.scoreB || 0 },
                    timer: m.timer || '0:00',
                    addedTime: m.addedTime || 0,
                    period: m.period || 'Pierwsza po≈Çowa',
                    events: { goals, substitutions, cards, lineup }
                };
            });
            
            updateLiveMatches(activeMatches);
            if (currentLeague === 'ekstraklasa') {
                renderFullTable('all');
            }
        })
        .catch(err => {
            console.warn('B≈ÇƒÖd pobierania statusu meczu:', err.message);
            if (lastValidMatchData) {
                updateLiveMatch(lastValidMatchData);
            }
        });
}

function clearLiveMatch() {
    const liveContainer = document.getElementById('live-match-container');
    if (!liveContainer) return;
    liveContainer.innerHTML = '<div style="color: #888; text-align: center; padding: 1rem; font-size: 0.9rem;">Brak aktywnych mecz√≥w</div>';
    matchGoals = [];
    currentMatchTeamA = null;
    currentMatchTeamB = null;
    localStorage.removeItem('matchGoals');
    localStorage.removeItem('currentMatchTeamA');
    localStorage.removeItem('currentMatchTeamB');
    localStorage.removeItem('lastValidMatchData');
    localStorage.removeItem('matchEvents');
}

function selectMatchAndOpenDetail(matchIndex) {
    if (!allLiveMatches || !allLiveMatches[matchIndex]) return;
    
    selectedMatchIndex = matchIndex;
    const matchData = allLiveMatches[matchIndex];
    lastValidMatchData = matchData;
    currentMatchTeamA = matchData.teamA;
    currentMatchTeamB = matchData.teamB;
    
    if (matchData.events && matchData.events.goals && matchData.events.goals.length > 0) {
        matchGoals = matchData.events.goals.map((g, i) => ({
            team: g.team,
            player: g.scorer || g.player,
            minute: g.minute,
            teamLetter: g.team === 'home' ? 'A' : 'B',
            score: `${matchData.teamA.score}:${matchData.teamB.score}`,
            timestamp: g.timestamp,
            commentary: g.commentary || getRandomCommentary(),
            id: i
        }));
    } else {
        matchGoals = [];
    }
    
    localStorage.setItem('lastValidMatchData', JSON.stringify(matchData));
    updateMatchDetailPage();
    openMatchDetailModal();
}

function openMatchDetailFromSidebar(teamAName, teamBName, result) {
    currentMatchTeamA = { nazwa: teamAName, score: parseInt(result.split(':')[0]) || 0 };
    currentMatchTeamB = { nazwa: teamBName, score: parseInt(result.split(':')[1]) || 0 };
    
    localStorage.setItem('currentMatchTeamA', JSON.stringify(currentMatchTeamA));
    localStorage.setItem('currentMatchTeamB', JSON.stringify(currentMatchTeamB));
    
    fetchApi('/api/matches')
        .then(matches => {
            if (!Array.isArray(matches)) throw new Error('Invalid matches format');
            const match = matches.find(m => m.teamA === teamAName && m.teamB === teamBName);
            if (match && match.goals) {
                matchGoals = [];
                match.goals.forEach(goal => {
                    const teamLetter = goal.team === teamAName ? 'A' : 'B';
                    matchGoals.push({
                        team: goal.team,
                        player: goal.player,
                        minute: goal.minute,
                        teamLetter: teamLetter,
                        score: result
                    });
                });
                localStorage.setItem('matchGoals', JSON.stringify(matchGoals));
            }
        })
        .catch(err => {
            console.warn('B≈ÇƒÖd pobierania goli:', err.message);
            matchGoals = [];
        })
        .finally(() => {
            showView('match-detail');
            updateMatchDetailPage();
            displayFactsTab();
        });
}

function openMatchDetailModal() {
    if (!currentMatchTeamA || !currentMatchTeamB) {
        loadStoredMatchData();
        if (!currentMatchTeamA || !currentMatchTeamB) return;
    }
    
    showView('match-detail');
    updateMatchDetailPage();
    displayFactsTab();
}

let detailTabRefreshInterval = null;
let allLiveMatches = [];
let selectedMatchIndex = 0;

function switchDetailTab(tab, btn) {
    const btns = document.querySelectorAll('.match-detail-tab-btn-clean');
    btns.forEach(b => {
        b.classList.remove('active');
    });
    
    if (btn) {
        btn.classList.add('active');
    }
    
    const panes = document.querySelectorAll('.match-detail-pane-clean');
    panes.forEach(pane => pane.classList.remove('active'));
    
    const tabMap = {
        'facts': 'facts-content',
        'live': 'live-content',
        'lineup': 'lineup-content',
        'stats': 'stats-content'
    };
    
    if (tabMap[tab]) {
        const pane = document.getElementById(tabMap[tab]);
        if (pane) pane.classList.add('active');
    }
    
    if (tab === 'facts') {
        displayFactsTab();
    } else if (tab === 'live') {
        displayLiveTab();
    } else if (tab === 'lineup') {
        displayLineupTab();
    } else if (tab === 'stats') {
        displayStatsTab();
    }
}

const goalCommentaries = [
    'gola po piƒôknej akcji strzeli≈Ç:',
    'wykorzysta≈Ç okazjƒô i strzeli≈Ç:',
    '≈õwietnie siƒô posunƒÖ≈Ç i gol!:',
    'zdecydowanym strza≈Çem zmieni≈Ç losy meczu:',
    'bez zbƒôdnych ceregieli trafia:',
    'najlepszy moment, najlepszy gol:',
    'precyzyjny strza≈Ç i gol:',
    'bƒôdƒÖc pod presjƒÖ, strzeli≈Ç gola:',
    'w szesnastce znalaz≈Ç idealny kat:',
    'efektownie rozegra≈Ç ostatnie podania:',
    'koniec ≈Çadnej akcji dru≈ºyny:',
    'po b≈Çƒôdzie obrony dru≈ºyn przeciwnika:',
    'z bliskiej odleg≈Ço≈õci nie m√≥g≈Ç chybiƒá:',
];

function getRandomCommentary() {
    return goalCommentaries[Math.floor(Math.random() * goalCommentaries.length)];
}

function displayDetailMatchRelation() {
    const container = document.getElementById('detail-relacja-content');
    if (!container) return;
    
    let matchData = lastValidMatchData;
    if (allLiveMatches && allLiveMatches[selectedMatchIndex]) {
        matchData = allLiveMatches[selectedMatchIndex];
    }
    
    if (!matchData || !matchData.events) {
        console.log('[RELACJA] Brak danych:', { matchData, selectedMatchIndex, allLiveMatches: allLiveMatches?.length });
        container.innerHTML = '<div style="text-align: center; color: #888; padding: 2rem;">Brak danych o meczach</div>';
        return;
    }
    
    const events = matchData.events;
    const goals = events.goals || [];
    const subs = events.substitutions || [];
    
    console.log('[RELACJA] Wy≈õwietlam mecz:', { goals: goals.length, subs: subs.length });
    
    let allEvents = [];
    
    goals.forEach(goal => {
        const isTeamA = goal.team === 'home';
        const teamName = isTeamA ? matchData.teamA.nazwa : matchData.teamB.nazwa;
        const playerName = goal.scorer || goal.player || 'Nieznany gracz';
        
        allEvents.push({
            type: 'goal',
            minute: goal.minute,
            team: goal.team,
            teamLetter: isTeamA ? 'A' : 'B',
            player: playerName,
            teamName: teamName,
            score: `${currentMatchTeamA?.score}:${currentMatchTeamB?.score}`,
            commentary: goal.commentary || goal.savedCommentary || getRandomCommentary()
        });
    });
    
    subs.forEach(sub => {
        allEvents.push({
            type: 'substitution',
            minute: sub.minute,
            playerOut: sub.playerOut,
            playerIn: sub.playerIn
        });
    });
    
    allEvents.sort((a, b) => a.minute - b.minute);
    
    if (allEvents.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #888; padding: 2rem;">Brak zdarze≈Ñ w tym meczu</div>';
        return;
    }
    
    let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
    
    allEvents.forEach(event => {
        if (event.type === 'goal') {
            const roundedTime = roundTimeToMinute(event.minute);
            
            html += `
                <div style="background: #1a1a1a; border-bottom: 1px solid #333; padding: 0.8rem 1rem; display: flex; justify-content: space-between; align-items: center;">
                    <div style="color: white; font-weight: bold; font-size: 1rem;">‚öΩ ${event.teamName} - ${event.player}</div>
                    <div style="color: #888; font-size: 0.9rem;">${roundedTime}'</div>
                </div>
            `;
        } else if (event.type === 'substitution') {
            const roundedTime = roundTimeToMinute(event.minute);
            html += `
                <div style="display: flex; justify-content: center;">
                    <div style="background: rgba(100, 100, 100, 0.2); border-left: 3px solid #ffaa00; padding: 1rem; border-radius: 4px; max-width: 400px; text-align: center;">
                        <div style="color: white; font-weight: bold; font-size: 1rem;">‚¨áÔ∏è #${event.playerOut} ‚Üí ‚¨ÜÔ∏è #${event.playerIn}</div>
                        <div style="color: #888; font-size: 0.9rem; margin-top: 0.5rem;">Minuta ${roundedTime}</div>
                    </div>
                </div>
            `;
        }
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function displayDetailMatchStatistics() {
    const container = document.getElementById('detail-statystyki-content');
    if (!container) return;
    
    const goalsTeamA = matchGoals.filter(g => g.teamLetter === 'A').length;
    const goalsTeamB = matchGoals.filter(g => g.teamLetter === 'B').length;
    
    let html = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div style="text-align: center;">
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 1rem;">GOLE</div>
                <div style="color: #00aaff; font-size: 3rem; font-weight: bold;">${goalsTeamA}</div>
            </div>
            <div style="text-align: center;">
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 1rem;">GOLE</div>
                <div style="color: #00aaff; font-size: 3rem; font-weight: bold;">${goalsTeamB}</div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function displayDetailMatchLineup() {
    const container = document.getElementById('detail-sklady-content');
    if (!container) return;
    
    let matchData = lastValidMatchData;
    if (allLiveMatches && allLiveMatches[selectedMatchIndex]) {
        matchData = allLiveMatches[selectedMatchIndex];
    }
    
    let html = '<div style="display: flex; flex-direction: column; gap: 2rem;">';
    
    if (matchData && matchData.events) {
        const events = matchData.events;
        const subs = events.substitutions || [];
        const lineup = events.lineup;
        
        if (subs.length === 0 && !lineup) {
            html += '<div style="text-align: center; color: #888; padding: 2rem;">Brak informacji o zmianach i sk≈Çadzie</div>';
        } else {
            if (lineup) {
                html += `
                    <div style="background: rgba(0, 100, 150, 0.2); border-left: 3px solid #00aaff; padding: 1rem; border-radius: 4px;">
                        <div style="color: #00aaff; font-weight: bold; font-size: 1.1rem;">üìã Sk≈Çad dru≈ºyny</div>
                        <div style="color: #888; font-size: 0.9rem; margin-top: 0.5rem;">Formacja: ${lineup.formation || 'Nieznana'}</div>
                        <div style="color: #888; font-size: 0.85rem; margin-top: 0.3rem;">PoczƒÖtek meczu</div>
                    </div>
                `;
            }
            
            if (subs.length > 0) {
                html += '<div style="padding-top: 1rem;"><div style="color: #888; font-size: 0.9rem; margin-bottom: 1rem; text-transform: uppercase;">Zmiany zawodnik√≥w:</div>';
                
                subs.forEach(sub => {
                    const roundedTime = roundTimeToMinute(sub.minute || 0);
                    html += `
                        <div style="background: rgba(100, 100, 100, 0.2); border-left: 3px solid #ffaa00; padding: 0.8rem; border-radius: 4px; margin-bottom: 0.8rem;">
                            <div style="color: white; font-weight: bold; font-size: 0.95rem;">‚¨áÔ∏è #${sub.playerOut} ‚Üí ‚¨ÜÔ∏è #${sub.playerIn}</div>
                            <div style="color: #888; font-size: 0.85rem; margin-top: 0.3rem;">Minuta ${roundedTime}</div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }
        }
    } else {
        html += '<div style="text-align: center; color: #888; padding: 2rem;">Brak danych o zmianach i sk≈Çadzie</div>';
    }
    
    html += '</div>';
    container.innerHTML = html;
}

function updateMatchDetailPage() {
    if (!currentMatchTeamA || !currentMatchTeamB) return;
    
    let matchData = lastValidMatchData;
    if (allLiveMatches && allLiveMatches[selectedMatchIndex]) {
        matchData = allLiveMatches[selectedMatchIndex];
        lastValidMatchData = matchData;
    }
    
    const logoA = getTeamLogo(currentMatchTeamA.nazwa);
    const logoB = getTeamLogo(currentMatchTeamB.nazwa);
    
    document.getElementById('detail-team-a-logo-clean').src = logoA;
    document.getElementById('detail-team-b-logo-clean').src = logoB;
    
    document.getElementById('detail-team-a-name-clean').textContent = currentMatchTeamA.nazwa;
    document.getElementById('detail-team-b-name-clean').textContent = currentMatchTeamB.nazwa;
    
    document.getElementById('detail-score-clean').textContent = `${currentMatchTeamA.score}-${currentMatchTeamB.score}`;
    
    document.getElementById('match-league-name-clean').textContent = 'Liga Meczu';
    
    if (matchData) {
        const timerEl = document.getElementById('detail-timer-clean');
        if (timerEl && matchData.timer) {
            timerEl.textContent = matchData.timer;
        }
        let isFinished = false;
        if (matchData.active === true || matchData.active === 'true') {
            isFinished = false;
        } else if (matchData.active === false || matchData.active === 'false') {
            isFinished = false;
        } else {
            isFinished = true;
        }
        
        if (isFinished) {
            const matchKey = `match_${selectedMatchIndex}_${currentMatchTeamA.nazwa}_${currentMatchTeamB.nazwa}`;
            const dataToSave = {
                ...matchData,
                status: 'KONIEC',
                finished: true,
                teamA: currentMatchTeamA,
                teamB: currentMatchTeamB
            };
            localStorage.setItem(matchKey, JSON.stringify(dataToSave));
        }
    }
    
    updateEventsList();
    displayFactsTab();
    updateTopStats();
    updateMatchEvents();
    updateEventFeed();
    
    if (previousTeamAScore !== null && previousTeamBScore !== null) {
        if (currentMatchTeamA.score > previousTeamAScore || currentMatchTeamB.score > previousTeamBScore) {
            playGoalSound();
        }
    }
    
    previousTeamAScore = currentMatchTeamA.score;
    previousTeamBScore = currentMatchTeamB.score;
}

function updateEventsList() {
    const scorersBar = document.getElementById('match-detail-scorers-bar');
    if (!scorersBar) return;
    
    let matchData = lastValidMatchData;
    if (allLiveMatches && allLiveMatches[selectedMatchIndex]) {
        matchData = allLiveMatches[selectedMatchIndex];
    }
    
    let html = '';
    
    if (matchData && matchData.events && matchData.events.goals) {
        const goals = matchData.events.goals || [];
        
        if (goals.length > 0) {
            goals.forEach(goal => {
                const minute = (goal.minute || 0) + "'";
                const player = goal.scorer || goal.player || 'Nieznany';
                
                html += `<span class="match-detail-scorer-badge">${player} <strong>${minute}</strong></span>`;
            });
        }
    }
    
    scorersBar.innerHTML = html;
}

function updateTopStats() {
    const container = document.getElementById('top-stats-content');
    if (!container) return;
    
    let html = `
        <div class="stat-item">
            <div class="stat-label">Posiadanie pi≈Çki</div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
                <div class="stat-value" style="color: #ff6b9d;">48%</div>
                <div class="stat-value" style="color: #ff4444;">52%</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Oczekiwane bramki (xG)</div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                <div class="stat-value">1.02</div>
                <div class="stat-value">1.31</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Ca≈Çkowite strza≈Çy</div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                <div class="stat-value">12</div>
                <div class="stat-value">15</div>
            </div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Wielkie szanse</div>
            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                <div class="stat-value">2</div>
                <div class="stat-value">3</div>
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function updateMatchEvents() {
    const container = document.getElementById('match-events-content');
    if (!container) return;
    
    let matchData = lastValidMatchData;
    if (allLiveMatches && allLiveMatches[selectedMatchIndex]) {
        matchData = allLiveMatches[selectedMatchIndex];
    }
    
    if (!matchData || !matchData.events) {
        container.innerHTML = '<div style="text-align: center; color: #888; padding: 2rem;">Brak zdarze≈Ñ</div>';
        return;
    }
    
    const events = matchData.events;
    const goals = events.goals || [];
    const subs = events.substitutions || [];
    const cards = events.cards || [];
    
    let allEvents = [];
    
    goals.forEach(goal => {
        const isTeamA = goal.team === 'home';
        allEvents.push({
            type: 'goal',
            minute: goal.minute,
            isTeamA: isTeamA,
            player: goal.scorer || goal.player || 'Nieznany',
            assist: goal.assist || null,
            score: `${goal.score || '?'}`
        });
    });
    
    subs.forEach(sub => {
        allEvents.push({
            type: 'substitution',
            minute: sub.minute,
            playerOut: sub.playerOut || 'Gracz',
            playerIn: sub.playerIn || 'Gracz'
        });
    });
    
    cards.forEach(card => {
        allEvents.push({
            type: 'card',
            minute: card.minute,
            player: card.player || 'Gracz',
            color: card.color || 'yellow'
        });
    });
    
    allEvents.sort((a, b) => a.minute - b.minute);
    
    if (allEvents.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #888; padding: 2rem;">Brak zdarze≈Ñ</div>';
        return;
    }
    
    let html = '<div class="match-events-timeline">';
    let lastScore = '0 - 0';
    
    allEvents.forEach((event, idx) => {
        const roundedTime = roundTimeToMinute(event.minute);
        
        if (event.type === 'goal') {
            const teamName = event.isTeamA ? currentMatchTeamA.nazwa : currentMatchTeamB.nazwa;
            const oppositeTeam = event.isTeamA ? currentMatchTeamB.nazwa : currentMatchTeamA.nazwa;
            
            if (event.isTeamA) {
                html += `
                    <div class="event-row goal-row">
                        <div class="event-left">
                            <div class="event-left-player">‚öΩ ${event.player}</div>
                            ${event.assist ? `<div class="event-left-assist">asystysta: ${event.assist}</div>` : ''}
                        </div>
                        <div class="event-center">
                            <div class="event-time">${roundedTime}'</div>
                            <div class="event-icon">‚öΩ</div>
                        </div>
                        <div class="event-right" style="visibility: hidden;"></div>
                    </div>
                `;
            } else {
                html += `
                    <div class="event-row goal-row">
                        <div class="event-left" style="visibility: hidden;"></div>
                        <div class="event-center">
                            <div class="event-icon">‚öΩ</div>
                            <div class="event-time">${roundedTime}'</div>
                        </div>
                        <div class="event-right">
                            <div class="event-right-player">‚öΩ ${event.player}</div>
                            ${event.assist ? `<div class="event-right-assist">asystysta: ${event.assist}</div>` : ''}
                        </div>
                    </div>
                `;
            }
        } else if (event.type === 'substitution') {
            html += `
                <div class="event-row substitution-row">
                    <div class="event-left">
                        <div style="color: #888; font-size: 0.85rem;">‚Üì ${event.playerOut}</div>
                    </div>
                    <div class="event-center">
                        <div class="event-time">${roundedTime}'</div>
                        <div class="event-substitution-icon">‚ü∑</div>
                    </div>
                    <div class="event-right">
                        <div style="color: #00aaff; font-size: 0.85rem;">‚Üë ${event.playerIn}</div>
                    </div>
                </div>
            `;
        } else if (event.type === 'card') {
            const cardIcon = event.color === 'red' ? 'üî¥' : 'üü®';
            const cardColor = event.color === 'red' ? '#f44336' : '#ffeb3b';
            html += `
                <div class="event-row card-row">
                    <div class="event-center">
                        <div class="event-time">${roundedTime}'</div>
                        <div style="font-size: 1.5rem;">${cardIcon}</div>
                    </div>
                    <div style="color: ${cardColor}; font-weight: 600; text-align: center;">
                        ${event.player}
                    </div>
                    <div></div>
                </div>
            `;
        }
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function fetchLeagueTable() {
    fetchApi('/api/league/table?t=' + Date.now())
        .then(data => {
            if (data && Array.isArray(data) && data.length > 0) {
                console.log('Pobrano tabelƒô z serwera:', data);
                tablekaEkstraklasa = data;
                if (currentLeague === 'ekstraklasa') {
                    tabela = tablekaEkstraklasa;
                    renderFullTable('all');
                }
            } else {
                console.warn('Pusta lub nieprawid≈Çowa tabela z serwera, u≈ºywam lokalnej.');
            }
        })
        .catch(err => {
            console.warn('B≈ÇƒÖd pobierania tabeli (u≈ºywam lokalnej):', err);
        });
}

window.addEventListener('load', () => {
    // Najpierw wyrenderuj tabelƒô z danych lokalnych
    if (currentLeague === 'ekstraklasa') {
        tabela = tablekaEkstraklasa;
        renderFullTable('all');
    }
    
    clearLiveMatch();
    pollInterval = setInterval(pollMatchStatus, 2000);
    pollMatchStatus();
});

window.addEventListener('beforeunload', () => {
    if (pollInterval) clearInterval(pollInterval);
});

const druzyny = [
    { id: 1, nazwa: 'Unia Sienkiewicze', skrot: 'USI', logo: 'https://uniaskierniewice.pl/_next/image?url=%2Fimages%2Flogo%2Funia_logo-300x300.png&w=384&q=75', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 2, nazwa: 'Legia Warszawa', skrot: 'LEG', logo: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Legia_Warsaw_logo.png', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 3, nazwa: 'Pogo≈Ñ Szczecin', skrot: 'POG', logo: 'https://pogoncdn.stellis.one/imgsize-xs/documents/7740889/44a6ff9f-f346-69e6-890c-c6f10c6e891b', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 4, nazwa: 'Arka Gdynia', skrot: 'ARK', logo: 'https://arka.gdynia.pl/files/herb/arka_gdynia_mzks_kolor.png', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 5, nazwa: 'Lech Pozna≈Ñ', skrot: 'LPO', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/b/b0/KKS_Lech_Pozna%C5%84.svg/960px-KKS_Lech_Pozna%C5%84.svg.png', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 6, nazwa: 'Zawisza Bydgoszcz', skrot: 'ZAW', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/55/Herb_Zawiszy_Bydgoszcz.png', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 7, nazwa: 'Lechia Gda≈Ñsk', skrot: 'LGD', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/b/b7/Lechia_Gda%C5%84sk_logo.svg/1200px-Lechia_Gda%C5%84sk_logo.svg.png', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' },
    { id: 8, nazwa: 'Zag≈Çƒôbie Lubin', skrot: 'ZAG', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/2/20/Zag%C5%82%C4%99bie_Lubin_crest.svg/1200px-Zag%C5%82%C4%99bie_Lubin_crest.svg.png', stadium: 'https://media.discordapp.net/attachments/1446799327065280552/1451313899751342241/image_6.png?ex=6947b325&is=694661a5&hm=a9fa03e183102383dd24229907f1a7a0dbc3886fe4677d85536e5ba29c981322&=&format=webp&quality=lossless&width=1548&height=800' }
];

const userProfile = {
    id: 999,
    imie: 'Jan',
    nazwisko: 'Kowalski',
    profil: 'https://www.roblox.com/users/4674039540/profile',
    poziom: 42,
    doswiadczenie: 15000,
    mecze: 256,
    gole: 89,
    asysty: 34
};

const zawodnicy = [];

const newsy = [
    {
        id: 1,
        hero: true,
        tag: 'MECZ',
        tytul: 'Legia pokona≈Ça Arkƒô 3:2 w dramatycznym finale',
        data: '2025-12-19',
        tresc: '<p>W piƒÖtkowy wiecz√≥r Legia Warszawa zmierzy≈Ça siƒô z ArkƒÖ Gdynia w spotkaniu 18. kolejki Ekstraklasy. Spotkanie przyciƒÖgnƒô≈Ço 40 tysiƒôcy kibic√≥w na Stadion Narodowy.</p><p>Mecz przebiega≈Ç pod dyktando warszawian, kt√≥rzy ju≈º w 12. minucie wyszli na prowadzenie dziƒôki golowi Aleksandra Soszy≈Ñskiego. Druga po≈Çowa przynios≈Ça wiƒôcej emocji, a Arka niepodziewanie doprowdzi≈Ça do wyr√≥wnania w 67. minucie.</p><p>W dramatycznym ko≈Ñcu spotkania Legia strzelila dwa gole z rzƒôdu w ostatnich dziesiƒôciu minutach, aby ostatecznie wygraƒá 3:2. Najlepszy gracz meczu: Arkadiusz Milik - zawodnik Legii Warszawy.</p>'
    },
    {
        id: 2,
        hero: false,
        tag: 'WIADOMO≈öƒÜ',
        tytul: 'Lech Pozna≈Ñ zwolni≈Ç trenera',
        data: '2025-12-18',
        tresc: '<p>ZarzƒÖd Lech Pozna≈Ñ poinformowa≈Ç o rozwiƒÖzaniu umowy z trenerem Maciejem Skor≈ºƒÖ. Decyzja zosta≈Ça podjƒôta po serii s≈Çabych wynik√≥w w ostatnich meczach.</p><p>Lech zajmuje aktualnie 5. miejsce w tabeli Ekstraklasy z 28 punktami. Klub szuka ju≈º nastƒôpcy dla do≈õwiadczonego szkoleniowca.</p>'
    },
    {
        id: 3,
        hero: false,
        tag: 'TRANSFERY',
        tytul: 'Pogo≈Ñ Szczecin sprowadza zawodnika z Premier League',
        data: '2025-12-17',
        tresc: '<p>Pogo≈Ñ Szczecin og≈Çosi≈Ça podpisanie kontraktu z Kamilem Grosickim. Cztery-letni kontrakt obejmuje zwiƒôkszone wynagrodzenie w stosunku do dotychczasowego klubu.</p><p>Grosicki to do≈õwiadczony zawodnik, kt√≥ry wcze≈õniej gra≈Ç w Premier League. Spodziewane jest, ≈ºe przyda si≈Ç ofensywnym dzia≈Çaniom Pogoni w drugiej po≈Çowie sezonu.</p>'
    }
];

let tablekaEkstraklasa = [
    { id: 2, nazwa: 'Legia Warszawa', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 5, nazwa: 'Lech Pozna≈Ñ', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 3, nazwa: 'Pogo≈Ñ Szczecin', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 4, nazwa: 'Arka Gdynia', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 7, nazwa: 'Lechia Gda≈Ñsk', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 8, nazwa: 'Zag≈Çƒôbie Lubin', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 6, nazwa: 'Zawisza Bydgoszcz', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 1, nazwa: 'Unia Sienkiewicze', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } }
];

const tabela1Liga = [
    { id: 100, nazwa: 'G√≥rnik ≈Åƒôczna', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 101, nazwa: 'Widzew ≈Å√≥d≈∫', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 102, nazwa: 'Podbeskidzie Tychy', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 103, nazwa: 'Resovia Rzesz√≥w', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 104, nazwa: 'Olimpia GrudziƒÖdz', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 105, nazwa: 'Chrobry G≈Çog√≥w', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 106, nazwa: 'GKS Jastrzƒôbie', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 107, nazwa: 'MKS Kalisz', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 108, nazwa: 'Skra Czƒôstochowa', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 109, nazwa: 'Bytovia Gdynia', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 110, nazwa: 'Sandecja Nowy SƒÖcz', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 111, nazwa: '≈ÅKS ≈Å√≥d≈∫', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 112, nazwa: 'Zag≈Çƒôbie Sosnowiec', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 113, nazwa: 'Wis≈Ça P≈Çock', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 114, nazwa: 'KS Arka Gda≈Ñsk', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 115, nazwa: 'Garbarnia Krak√≥w', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 116, nazwa: 'Elana Toru≈Ñ', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } },
    { id: 117, nazwa: 'Znicz Pruszk√≥w', mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [], domowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] }, wyjazdowe: { mecze: 0, wygrane: 0, remisy: 0, przegrane: 0, bramkiZa: 0, bramkiProti: 0, punkty: 0, forma: [] } }
];

let tabela = tablekaEkstraklasa;
let currentLeague = 'ekstraklasa';
let currentRound = 1;

const mecze = [];

const terminarz = [
    {
        kolejka: 1,
        daty: [
            { dzien: 'PiƒÖtek, 30 grudnia', mecze: [
                { id: 1, teamA: 'Legia Warszawa', teamB: 'Lech Pozna≈Ñ', czas: '15:00' }
            ]},
            { dzien: 'Sobota, 31 grudnia', mecze: [
                { id: 2, teamA: 'Pogo≈Ñ Szczecin', teamB: 'Arka Gdynia', czas: '17:30' },
                { id: 3, teamA: 'Lechia Gda≈Ñsk', teamB: 'Zag≈Çƒôbie Lubin', czas: '17:30' }
            ]},
            { dzien: 'Niedziela, 1 stycznia', mecze: [
                { id: 4, teamA: 'Zawisza Bydgoszcz', teamB: 'Unia Sienkiewicze', czas: '19:00' }
            ]}
        ],
        mecze: [
            { id: 1, teamA: 'Legia Warszawa', teamB: 'Lech Pozna≈Ñ', czas: '15:00' },
            { id: 2, teamA: 'Pogo≈Ñ Szczecin', teamB: 'Arka Gdynia', czas: '17:30' },
            { id: 3, teamA: 'Lechia Gda≈Ñsk', teamB: 'Zag≈Çƒôbie Lubin', czas: '17:30' },
            { id: 4, teamA: 'Zawisza Bydgoszcz', teamB: 'Unia Sienkiewicze', czas: '19:00' }
        ]
    },
    {
        kolejka: 2,
        daty: [
            { dzien: 'PiƒÖtek, 7 stycznia', mecze: [
                { id: 5, teamA: 'Lech Pozna≈Ñ', teamB: 'Pogo≈Ñ Szczecin', czas: '15:00' }
            ]},
            { dzien: 'Sobota, 8 stycznia', mecze: [
                { id: 6, teamA: 'Arka Gdynia', teamB: 'Legia Warszawa', czas: '17:30' },
                { id: 7, teamA: 'Zag≈Çƒôbie Lubin', teamB: 'Zawisza Bydgoszcz', czas: '17:30' }
            ]},
            { dzien: 'Niedziela, 9 stycznia', mecze: [
                { id: 8, teamA: 'Unia Sienkiewicze', teamB: 'Lechia Gda≈Ñsk', czas: '19:00' }
            ]}
        ],
        mecze: [
            { id: 5, teamA: 'Lech Pozna≈Ñ', teamB: 'Pogo≈Ñ Szczecin', czas: '15:00' },
            { id: 6, teamA: 'Arka Gdynia', teamB: 'Legia Warszawa', czas: '17:30' },
            { id: 7, teamA: 'Zag≈Çƒôbie Lubin', teamB: 'Zawisza Bydgoszcz', czas: '17:30' },
            { id: 8, teamA: 'Unia Sienkiewicze', teamB: 'Lechia Gda≈Ñsk', czas: '19:00' }
        ]
    },
    {
        kolejka: 18,
        daty: [
            { dzien: 'PiƒÖtek, 30 stycznia', mecze: [
                { id: 1, teamA: 'Legia Warszawa', teamB: 'Lech Pozna≈Ñ', czas: '16:00' }
            ]},
            { dzien: 'Sobota, 31 stycznia', mecze: [
                { id: 2, teamA: 'Pogo≈Ñ Szczecin', teamB: 'Arka Gdynia', czas: '17:30' },
                { id: 3, teamA: 'Zag≈Çƒôbie Lubin', teamB: 'Zawisza Bydgoszcz', czas: '15:00' }
            ]}
        ],
        mecze: [
            { id: 1, teamA: 'Legia Warszawa', teamB: 'Lech Pozna≈Ñ', czas: '16:00' },
            { id: 2, teamA: 'Pogo≈Ñ Szczecin', teamB: 'Arka Gdynia', czas: '17:30' },
            { id: 3, teamA: 'Zag≈Çƒôbie Lubin', teamB: 'Zawisza Bydgoszcz', czas: '15:00' }
        ]
    }
];

function loadNews() {
    const heroContainer = document.getElementById('hero-news');
    const gridContainer = document.getElementById('news-grid');
    
    const heroNews = newsy.find(n => n.hero);
    const otherNews = newsy.filter(n => !n.hero);
    
    if (heroNews) {
        heroContainer.innerHTML = `
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #1e3c72, #2a5298); z-index: -1;"></div>
            <div class="hero-content">
                <span class="hero-tag">${heroNews.tag}</span>
                <div class="hero-title">${heroNews.tytul}</div>
                <div class="news-date">${heroNews.data}</div>
            </div>
        `;
        heroContainer.style.cursor = 'pointer';
        heroContainer.onclick = () => openNewsModal(heroNews.id);
    } else {
        heroContainer.innerHTML = `
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #1e3c72, #2a5298); z-index: -1;"></div>
            <div class="hero-content">
                <span class="hero-tag">BRAK NEWSA</span>
                <div class="hero-title">Brak aktualno≈õci</div>
                <div class="news-date">--</div>
            </div>
        `;
    }
    
    const youtubeNews = [
        { title: 'Legia - Piast | SKR√ìT | Dochrapali siƒô! | Ekstraklasa 2025/26', source: 'YouTube', time: '7 dni temu', thumbnail: '1-1' },
        { title: 'Rak√≥w - Zag≈Çƒôbie | SKR√ìT | Po≈ºegnanie Papszuny? | Ekstraklasa 2025/26', source: 'YouTube', time: 'w zesz≈Çym tygodniu', thumbnail: '1-1' },
        { title: 'Korona - Wis≈Ça P≈Çock | SKR√ìT | Nowy lider! | Ekstraklasa 2025/26', source: 'YouTube', time: '2 dni temu', thumbnail: '1-1' },
        { title: 'Cracovia - Lech | SKR√ìT | Piƒôkne gole rezerwowych! | Ekstraklasa 2025/26', source: 'YouTube', time: '2 dni temu', thumbnail: '2-2' },
        { title: 'Piast - Legia | SKR√ìT | 8 miecz bez wygranej! | Ekstraklasa 2025/26', source: 'YouTube', time: '2 tygodnie temu', thumbnail: '0-0' },
        { title: 'Zag≈Çƒôbie - Widzew | SKR√ìT | Szale≈Ñstwo! Gol w ostatniej sekundzie! | Ekstraklasa 2025/26', source: 'YouTube', time: '2 tygodnie temu', thumbnail: '1-2' },
        { title: 'Lechia - G√≥rnik | SKR√ìT | Piƒôkne gole rezerwowych! | Ekstraklasa 2025/26', source: 'YouTube', time: '2 dni temu', thumbnail: '1-2' }
    ];
    
    gridContainer.innerHTML = '<div style="grid-column: 1 / -1; padding: 1rem 0;"><h2 style="color: white; text-transform: uppercase; font-size: 1.3rem; margin-bottom: 1.5rem;">NEWSY</h2></div>';
    
    youtubeNews.forEach(news => {
        gridContainer.innerHTML += `
            <div class="news-card" style="background: rgba(0, 30, 60, 0.4); border: 1px solid rgba(0, 170, 255, 0.1); cursor: pointer; transition: all 0.3s;">
                <div style="width: 100%; height: 150px; background: linear-gradient(135deg, #1a3a52, #0d1f2d); display: flex; align-items: center; justify-content: center; position: relative;">
                    <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0, 0, 0, 0.8); color: white; padding: 4px 8px; border-radius: 3px; font-size: 0.75rem; font-weight: bold;">OT MECZU</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; height: 100%; align-content: center; justify-content: center;">
                        <div style="display: flex; align-items: center; justify-content: center; border-right: 1px solid rgba(0, 170, 255, 0.2);">
                            <div style="color: #00aaff; font-weight: bold; font-size: 1.5rem;">${news.thumbnail.split('-')[0]}</div>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: center;">
                            <div style="color: #00aaff; font-weight: bold; font-size: 1.5rem;">${news.thumbnail.split('-')[1]}</div>
                        </div>
                    </div>
                </div>
                <div class="news-card-content">
                    <div class="news-card-title" style="font-size: 0.95rem; line-height: 1.3;">${news.title}</div>
                    <div style="color: #888; font-size: 0.8rem; margin-top: 0.5rem;">${news.source} ‚Ä¢ ${news.time}</div>
                </div>
            </div>
        `;
    });
}

function openNewsModal(newsId) {
    const news = newsy.find(n => n.id === newsId);
    if (!news) return;
    
    showArticleDetail(newsId);
}

function showArticleDetail(newsId) {
    const news = newsy.find(n => n.id === newsId);
    if (!news) return;
    
    const container = document.getElementById('article-content');
    container.innerHTML = `
        <div style="max-width: 800px; margin: 0 auto;">
            <button onclick="showView('news')" style="background: rgba(51, 51, 51, 0.8); border: 1px solid #555; color: white; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-bottom: 2rem; display: inline-block;">‚Üê Wr√≥ƒá do aktualno≈õci</button>
            
            <article style="background: rgba(20, 20, 20, 0.9); border: 1px solid #333; border-radius: 8px; padding: 3rem; color: white;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <span style="background: #0056b3; color: white; padding: 6px 14px; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; display: inline-block; margin-bottom: 1.5rem;">${news.tag}</span>
                    <h1 style="font-size: 2.2rem; margin: 0 0 1rem 0; line-height: 1.3;">${news.tytul}</h1>
                    <p style="color: #888; font-size: 0.95rem;">${news.data}</p>
                </div>
                
                <div style="line-height: 1.8; font-size: 1.1rem; color: #ddd;">
                    ${news.tresc}
                </div>
            </article>
        </div>
    `;
    
    showView('article');
}

function showClubsView() {
    const container = document.getElementById('clubs-grid');
    
    const ekstraklasaClubIds = [2, 5, 3, 4, 7, 8, 6, 1];
    const ekstraklasaClubs = ekstraklasaClubIds.map(id => druzyny.find(d => d.id === id)).filter(Boolean);
    
    let html = '';
    ekstraklasaClubs.forEach(club => {
        html += `
            <div class="club-card" onclick="openClubProfile(${club.id})">
                <div class="club-card-header">
                    <img src="${club.logo}" alt="${club.nazwa}" class="club-card-logo">
                </div>
                <div class="club-card-footer">
                    <div class="club-card-name">${club.nazwa}</div>
                    <div class="club-card-link">PROFIL KLUBU ‚Üí</div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function openClubProfile(clubId) {
    const club = druzyny.find(d => d.id === clubId);
    if (!club) return;
    
    const container = document.getElementById('club-profile-content');
    
    const clubStats = tablekaEkstraklasa.find(t => t.id === clubId);
    
    let successesHtml = '';
    if (clubId === 2) {
        successesHtml = `
            <div class="success-item">
                <div class="success-count">5X</div>
                <div class="success-name">Mistrzostwo Polski</div>
            </div>
            <div class="success-item">
                <div class="success-count">2X</div>
                <div class="success-name">Wicemistrzostwo Polski</div>
            </div>
            <div class="success-item">
                <div class="success-count">2X</div>
                <div class="success-name">BrƒÖzowy medal</div>
            </div>
            <div class="success-item">
                <div class="success-count">1X</div>
                <div class="success-name">Puchar Polski</div>
            </div>
            <div class="success-item">
                <div class="success-count">1X</div>
                <div class="success-name">Superpuchar Polski</div>
            </div>
        `;
    } else {
        successesHtml = `
            <div class="success-item">
                <div class="success-count">0</div>
                <div class="success-name">Brak wygranych</div>
            </div>
        `;
    }
    
    container.innerHTML = `
        <div style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.8)), url('${club.stadium}') center/cover fixed; min-height: 100vh;">
            <div style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
                <button onclick="showView('clubs')" style="background: rgba(51, 51, 51, 0.8); border: 1px solid #555; color: white; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-bottom: 2rem; display: inline-block;">‚Üê Wr√≥ƒá</button>
                
                <div style="background: linear-gradient(to right, rgba(20, 60, 100, 0.6), rgba(10, 30, 60, 0.8)); border: 2px solid #00aaff; border-radius: 8px; overflow: hidden; position: relative; padding: 3rem 2rem; margin-bottom: 3rem;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;">
                        <img src="${club.logo}" alt="${club.nazwa}" style="width: 100px; height: 100px; object-fit: contain;">
                        <div style="flex: 1; margin-left: 2rem;">
                            <h1 style="color: white; font-size: 2.5rem; margin: 0 0 0.5rem 0; text-transform: uppercase;">${club.nazwa}</h1>
                            <p style="color: #888; font-size: 1rem; margin: 0;">Stadion: ${club.nazwa}</p>
                        </div>
                        <a href="#" style="color: #00aaff; text-decoration: none; font-weight: bold;">BILETY ‚Üí</a>
                    </div>
                    
                    <div style="display: flex; gap: 2rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid rgba(0, 170, 255, 0.3);">
                        <a href="#" style="color: #00aaff; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                            <span>OFICJALNA STRONA KLUBU</span>
                            <span style="font-size: 0.8rem;">‚Üó</span>
                        </a>
                        <a href="#" style="color: #00aaff; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                            <span>KAPITU≈ÅA NAGRODY DRU≈ªYNSPOLEK</span>
                            <span style="font-size: 0.8rem;">‚Üó</span>
                        </a>
                    </div>
                    
                    <div style="display: flex; gap: 1.5rem; margin-top: 2rem;">
                        <a href="#" style="color: white; text-decoration: none;"><i class="fab fa-facebook"></i></a>
                        <a href="#" style="color: white; text-decoration: none;"><i class="fab fa-instagram"></i></a>
                        <a href="#" style="color: white; text-decoration: none;"><i class="fab fa-twitter"></i></a>
                        <a href="#" style="color: white; text-decoration: none;"><i class="fab fa-youtube"></i></a>
                        <a href="#" style="color: white; text-decoration: none;"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
                
                <div id="club-stats-boxes" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 3rem;">
                    <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                        <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">MECZE</div>
                        <div id="club-stat-matches" style="color: #00aaff; font-size: 2rem; font-weight: bold;">0</div>
                    </div>
                    <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                        <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">PUNKTY</div>
                        <div id="club-stat-points" style="color: #00aaff; font-size: 2rem; font-weight: bold;">0</div>
                    </div>
                    <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                        <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">ZWYCIƒòSTWA</div>
                        <div id="club-stat-wins" style="color: #00aaff; font-size: 2rem; font-weight: bold;">0</div>
                    </div>
                    <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                        <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">REMISY</div>
                        <div id="club-stat-draws" style="color: #00aaff; font-size: 2rem; font-weight: bold;">0</div>
                    </div>
                    <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                        <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">PORA≈ªKI</div>
                        <div id="club-stat-losses" style="color: #00aaff; font-size: 2rem; font-weight: bold;">0</div>
                    </div>
                    <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                        <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">BRAMKI</div>
                        <div id="club-stat-goals" style="color: #00aaff; font-size: 2rem; font-weight: bold;">0:0</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 2rem; border-bottom: 2px solid rgba(0, 170, 255, 0.3); margin-bottom: 2rem; padding-bottom: 1rem; overflow-x: auto;">
                    <button onclick="switchClubTab('about')" class="club-tab-btn active" style="background: none; border: none; color: white; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid #00aaff; white-space: nowrap;">PRZEGLƒÑD</button>
                    <button onclick="switchClubTab('table')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">TABELA</button>
                    <button onclick="switchClubTab('mecze')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">MECZE</button>
                    <button onclick="switchClubTab('stats')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">STATYSTYKI</button>
                    <button onclick="switchClubTab('seasons')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">SEZONY</button>
                    <button onclick="switchClubTab('squad')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">S≈ÅAD</button>
                    <button onclick="switchClubTab('trophies')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">TROFEA</button>
                    <button onclick="switchClubTab('news')" class="club-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent; white-space: nowrap;">NEWSY</button>
                </div>
                
                <div style="padding: 2rem; color: white;">
                    <div id="club-tab-about">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 1.5rem;">KLUB</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; margin-bottom: 2rem;">
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">ROK POWSTANIA</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">1906</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">PREZES</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">Mateusz Dro≈ºd≈º</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">POJEMNO≈öƒÜ STADIONU</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">14194</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">ADRES</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">ul. J√≥zefa Ka≈Çu≈ºy 1, 30-111 Krak√≥w</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">TRENER</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">Luka Elsner</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">TELEFON</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">+48 122 929 100</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">RZECZNIK PRASOWY</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">Kamil Jagody≈Ñski</div>
                            </div>
                            <div>
                                <div style="color: #888; font-size: 0.9rem; margin-bottom: 0.5rem; text-transform: uppercase;">E-MAIL</div>
                                <div style="color: white; font-size: 1.3rem; font-weight: bold;">klub@cracovia.pl</div>
                            </div>
                        </div>
                        
                        <hr style="border: none; border-top: 2px solid rgba(0, 170, 255, 0.3); margin: 3rem 0;">
                        
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 1.5rem; margin-top: 2rem;">SUKCESY</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
                            ${successesHtml}
                        </div>
                    </div>
                    <div id="club-tab-table" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">NAJLEPSI GRACZE</h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 3rem; margin-bottom: 3rem;">
                            <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); padding: 2rem; border-radius: 8px;">
                                <h3 style="color: #00aaff; text-transform: uppercase; margin: 0 0 1.5rem 0; font-size: 0.9rem;">Najlepiej oceniane</h3>
                                <div id="top-rated-players" style="display: flex; flex-direction: column; gap: 1.2rem;"></div>
                                <div style="text-align: center; margin-top: 1rem;">
                                    <a href="#" style="color: #00aaff; text-decoration: none; font-size: 0.9rem;">Wszyscy ‚Üí</a>
                                </div>
                            </div>
                            <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); padding: 2rem; border-radius: 8px;">
                                <h3 style="color: #00aaff; text-transform: uppercase; margin: 0 0 1.5rem 0; font-size: 0.9rem;">Najlepsi strzelcy</h3>
                                <div id="top-scorers" style="display: flex; flex-direction: column; gap: 1.2rem;"></div>
                                <div style="text-align: center; margin-top: 1rem;">
                                    <a href="#" style="color: #00aaff; text-decoration: none; font-size: 0.9rem;">Wszyscy ‚Üí</a>
                                </div>
                            </div>
                            <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); padding: 2rem; border-radius: 8px;">
                                <h3 style="color: #00aaff; text-transform: uppercase; margin: 0 0 1.5rem 0; font-size: 0.9rem;">Najwiƒôcej asyst</h3>
                                <div id="top-assists" style="display: flex; flex-direction: column; gap: 1.2rem;"></div>
                                <div style="text-align: center; margin-top: 1rem;">
                                    <a href="#" style="color: #00aaff; text-decoration: none; font-size: 0.9rem;">Wszyscy ‚Üí</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="club-tab-mecze" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">MECZE</h2>
                        <div id="club-matches-content" style="display: flex; flex-direction: column; gap: 2rem;"></div>
                    </div>
                    <div id="club-tab-stats" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">STATYSTYKI</h2>
                        <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); padding: 2rem; border-radius: 8px; text-align: center; color: #888;">
                            <p>Szczeg√≥≈Çowe statystyki bƒôdƒÖ dostƒôpne tutaj</p>
                        </div>
                    </div>
                    <div id="club-tab-seasons" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">SEZONY</h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem;" id="seasons-content"></div>
                    </div>
                    <div id="club-tab-squad" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">S≈ÅAD ZESPO≈ÅU</h2>
                        <div style="overflow-x: auto;" id="squad-content"></div>
                    </div>
                    <div id="club-tab-trophies" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">TROFEA</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;" id="trophies-content"></div>
                    </div>
                    <div id="club-tab-news" style="display: none;">
                        <h2 style="color: white; text-transform: uppercase; margin-bottom: 2rem;">NEWSY</h2>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;" id="news-content"></div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    setTimeout(() => {
        displayClubMatches(clubId);
    }, 100);
    
    showView('club-profile');
}

function displayClubMatches(clubId) {
    const container = document.getElementById('club-matches-content');
    if (!container) return;
    
    const club = druzyny.find(d => d.id === clubId);
    const clubName = club?.nazwa || '';
    
    const clubStats = tablekaEkstraklasa.find(t => t.id === clubId);
    
    if (clubStats) {
        document.getElementById('club-stat-matches').textContent = clubStats.mecze || 0;
        document.getElementById('club-stat-points').textContent = clubStats.punkty || 0;
        document.getElementById('club-stat-wins').textContent = clubStats.wygrane || 0;
        document.getElementById('club-stat-draws').textContent = clubStats.remisy || 0;
        document.getElementById('club-stat-losses').textContent = clubStats.przegrane || 0;
        document.getElementById('club-stat-goals').textContent = `${clubStats.bramkiZa || 0}:${clubStats.bramkiProti || 0}`;
    }
    
    let isPlaying = currentMatchTeamA && currentMatchTeamB && (currentMatchTeamA.nazwa === clubName || currentMatchTeamB.nazwa === clubName);
    
    let html = '';
    
    if (isPlaying) {
        html += `
            <div style="background: rgba(255, 100, 100, 0.1); border: 2px solid #ff4444; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                <div style="color: #ff6666; font-weight: bold; margin-bottom: 1rem; text-transform: uppercase;">üî¥ MECZ NA ≈ªYWO</div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="text-align: center; flex: 1;">
                        <div style="color: white; font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">${currentMatchTeamA.nazwa}</div>
                        <img src="${getTeamLogo(currentMatchTeamA.nazwa)}" style="width: 50px; height: 50px; object-fit: contain;">
                    </div>
                    <div style="text-align: center; padding: 0 2rem;">
                        <div style="color: #00aaff; font-size: 2.5rem; font-weight: bold;">${currentMatchTeamA.score}</div>
                        <div style="color: #666; font-size: 0.9rem; margin-top: 0.5rem;">vs</div>
                        <div style="color: #00aaff; font-size: 2.5rem; font-weight: bold;">${currentMatchTeamB.score}</div>
                    </div>
                    <div style="text-align: center; flex: 1;">
                        <div style="color: white; font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">${currentMatchTeamB.nazwa}</div>
                        <img src="${getTeamLogo(currentMatchTeamB.nazwa)}" style="width: 50px; height: 50px; object-fit: contain;">
                    </div>
                </div>
                <div style="text-align: center; color: #888; margin-top: 1rem; font-size: 0.9rem;">
                    ${lastValidMatchData?.timer || '0:00'} ${lastValidMatchData?.period || ''}
                </div>
            </div>
        `;
    }
    
    html += `<h3 style="color: #00aaff; text-transform: uppercase; margin: 2rem 0 1rem 0;">NAJBLI≈ªSZE MECZE</h3>`;
    
    const upcomingMatches = [
        { date: '22 grudnia 2025', opponent: 'Pogo≈Ñ Szczecin', home: true, time: '18:00' },
        { date: '26 grudnia 2025', opponent: 'Zag≈Çƒôbie Lubin', home: false, time: '15:00' },
        { date: '2 stycznia 2026', opponent: 'Lech Pozna≈Ñ', home: true, time: '20:00' }
    ];
    
    upcomingMatches.forEach(match => {
        const opponentClub = druzyny.find(d => d.nazwa === match.opponent);
        html += `
            <div style="background: rgba(0, 170, 255, 0.1); border: 1px solid rgba(0, 170, 255, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="color: #888; font-size: 0.85rem; margin-bottom: 0.5rem;">${match.date} - ${match.time}</div>
                        <div style="color: white; font-weight: bold; font-size: 1rem;">
                            ${match.home ? 'üè† U SIEBIE' : '‚úàÔ∏è NA WYJE≈πDZIE'}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: white; font-weight: bold;">${match.opponent}</div>
                        ${opponentClub ? `<img src="${opponentClub.logo}" style="width: 35px; height: 35px; object-fit: contain; margin-top: 0.5rem;">` : ''}
                    </div>
                </div>
            </div>
        `;
    });
    
    html += `<h3 style="color: #00aaff; text-transform: uppercase; margin: 2rem 0 1rem 0;">OSTATNIE MECZE</h3>`;
    
    const recentMatches = [
        { date: '19 grudnia 2025', opponent: 'Arka Gdynia', result: '3:2', win: true },
        { date: '15 grudnia 2025', opponent: 'Lechia Gda≈Ñsk', result: '1:1', draw: true },
        { date: '12 grudnia 2025', opponent: 'Zawisza Bydgoszcz', result: '0:2', loss: true }
    ];
    
    recentMatches.forEach(match => {
        const opponentClub = druzyny.find(d => d.nazwa === match.opponent);
        let resultColor = '#ff6666';
        let resultLabel = 'PRZEGRANA';
        if (match.win) {
            resultColor = '#66ff66';
            resultLabel = 'WYGRANA';
        } else if (match.draw) {
            resultColor = '#ffff66';
            resultLabel = 'REMIS';
        }
        
        html += `
            <div style="background: rgba(0, 170, 255, 0.1); border: 1px solid rgba(0, 170, 255, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="color: #888; font-size: 0.85rem; margin-bottom: 0.5rem;">${match.date}</div>
                        <div style="color: white; font-weight: bold;">${match.opponent}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: ${resultColor}; font-weight: bold; font-size: 1.2rem; margin-bottom: 0.5rem;">${match.result}</div>
                        <div style="color: ${resultColor}; font-size: 0.8rem; text-transform: uppercase;">${resultLabel}</div>
                    </div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function switchClubTab(tab) {
    const aboutDiv = document.getElementById('club-tab-about');
    const tableDiv = document.getElementById('club-tab-table');
    const meczDiv = document.getElementById('club-tab-mecze');
    const statsDiv = document.getElementById('club-tab-stats');
    const seasonsDiv = document.getElementById('club-tab-seasons');
    const squadDiv = document.getElementById('club-tab-squad');
    const trophiesDiv = document.getElementById('club-tab-trophies');
    const newsDiv = document.getElementById('club-tab-news');
    const btns = document.querySelectorAll('.club-tab-btn');
    
    btns.forEach(btn => {
        btn.style.color = '#888';
        btn.style.borderBottomColor = 'transparent';
    });
    
    if (event && event.target) {
        event.target.style.color = 'white';
        event.target.style.borderBottomColor = '#00aaff';
    }
    
    aboutDiv.style.display = tab === 'about' ? 'block' : 'none';
    tableDiv.style.display = tab === 'table' ? 'block' : 'none';
    meczDiv.style.display = tab === 'mecze' ? 'block' : 'none';
    statsDiv.style.display = tab === 'stats' ? 'block' : 'none';
    seasonsDiv.style.display = tab === 'seasons' ? 'block' : 'none';
    squadDiv.style.display = tab === 'squad' ? 'block' : 'none';
    trophiesDiv.style.display = tab === 'trophies' ? 'block' : 'none';
    newsDiv.style.display = tab === 'news' ? 'block' : 'none';
    
    if (tab === 'table') {
        displayClubTableContent();
    } else if (tab === 'mecze') {
        const clubId = parseInt(document.querySelector('[data-club-id]')?.getAttribute('data-club-id') || '2');
        displayClubMatches(clubId);
    } else if (tab === 'seasons') {
        displayClubSeasons();
    } else if (tab === 'squad') {
        displayClubSquad();
    } else if (tab === 'trophies') {
        displayClubTrophies();
    } else if (tab === 'news') {
        displayClubNews();
    }
}

function displayClubTableContent() {
    const ratedContainer = document.getElementById('top-rated-players');
    const scorersContainer = document.getElementById('top-scorers');
    const assistsContainer = document.getElementById('top-assists');
    
    const topRated = [
        { name: 'Lamine Yamal', club: 'Barcelona', rating: '8.42' },
        { name: 'Kylian Mbapp√©', club: 'Real Madrid', rating: '8.35' },
        { name: 'Raphinha', club: 'Barcelona', rating: '8.03' }
    ];
    
    const topScorers = [
        { name: 'Kylian Mbapp√©', club: 'Real Madrid', goals: '18' },
        { name: 'Ferran Torres', club: 'Barcelona', goals: '11' },
        { name: 'Vedat Muriqi', club: 'Mallorca', goals: '9' }
    ];
    
    const topAssists = [
        { name: 'Lamine Yamal', club: 'Barcelona', assists: '7' },
        { name: 'Marcus Rashford', club: 'Barcelona', assists: '6' },
        { name: 'Luis Milla', club: 'Getafe', assists: '6' }
    ];
    
    ratedContainer.innerHTML = topRated.map(p => `
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <div style="color: white; font-weight: 600; font-size: 0.95rem;">${p.name}</div>
                <div style="color: #888; font-size: 0.8rem;">${p.club}</div>
            </div>
            <div style="background: rgba(255, 100, 100, 0.2); color: #ff6b9d; padding: 0.4rem 0.8rem; border-radius: 4px; font-weight: bold; font-size: 0.9rem;">${p.rating}</div>
        </div>
    `).join('');
    
    scorersContainer.innerHTML = topScorers.map(p => `
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <div style="color: white; font-weight: 600; font-size: 0.95rem;">${p.name}</div>
                <div style="color: #888; font-size: 0.8rem;">${p.club}</div>
            </div>
            <div style="background: rgba(0, 170, 255, 0.2); color: #00aaff; padding: 0.4rem 0.8rem; border-radius: 4px; font-weight: bold; font-size: 0.9rem;">${p.goals}</div>
        </div>
    `).join('');
    
    assistsContainer.innerHTML = topAssists.map(p => `
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div>
                <div style="color: white; font-weight: 600; font-size: 0.95rem;">${p.name}</div>
                <div style="color: #888; font-size: 0.8rem;">${p.club}</div>
            </div>
            <div style="background: rgba(100, 200, 100, 0.2); color: #90ff00; padding: 0.4rem 0.8rem; border-radius: 4px; font-weight: bold; font-size: 0.9rem;">${p.assists}</div>
        </div>
    `).join('');
}

function displayClubSeasons() {
    const container = document.getElementById('seasons-content');
    const seasons = [
        { year: '2024/2025', champion: 'Barcelona', runner: 'Real Madrid' },
        { year: '2023/2024', champion: 'Real Madrid', runner: 'Barcelona' },
        { year: '2022/2023', champion: 'Barcelona', runner: 'Real Madrid' },
        { year: '2021/2022', champion: 'Real Madrid', runner: 'Barcelona' },
        { year: '2020/2021', champion: 'Atl√©tico Madrid', runner: 'Real Madrid' },
        { year: '2019/2020', champion: 'Real Madrid', runner: 'Barcelona' }
    ];
    
    container.innerHTML = seasons.map(s => `
        <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); padding: 1.5rem; border-radius: 8px;">
            <div style="color: #00aaff; font-weight: bold; font-size: 1.1rem; margin-bottom: 1.5rem;">${s.year}</div>
            <div style="display: flex; align-items: center; gap: 0.8rem; margin-bottom: 1rem;">
                <span style="font-size: 1.3rem;">üèÜ</span>
                <div>
                    <div style="color: #888; font-size: 0.8rem; text-transform: uppercase;">Mistrz</div>
                    <div style="color: white; font-weight: bold;">${s.champion}</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 0.8rem;">
                <span style="font-size: 1.3rem;">ü•à</span>
                <div>
                    <div style="color: #888; font-size: 0.8rem; text-transform: uppercase;">Wicemistrz</div>
                    <div style="color: white; font-weight: bold;">${s.runner}</div>
                </div>
            </div>
        </div>
    `).join('');
}

function displayClubNews() {
    const container = document.getElementById('news-content');
    const newsItems = [
        {
            title: 'Watch: Jan Oblak produces stunning Save of the Season contender for Atl√©tico vs Girona',
            source: 'Get Spanish Football News',
            time: '1 godzinƒô temu',
            image: 'url'
        },
        {
            title: 'Hansi Flick admits Barcelona star \'saved us\' vs Villarreal',
            source: 'Get Spanish Football News',
            time: '2 godziny temu',
            image: 'url'
        },
        {
            title: 'Photo: Liverpool youngster secures Vinicius Jr\'s Real Madrid jersey after win over Sevilla',
            source: 'Get Spanish Football News',
            time: '2 godziny temu',
            image: 'url'
        }
    ];
    
    let html = '<div style="display: flex; flex-direction: column; gap: 1.5rem;">';
    
    newsItems.forEach((news, idx) => {
        if (idx === 0) {
            html += `
                <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); border-radius: 8px; overflow: hidden;">
                    <div style="height: 250px; background: linear-gradient(135deg, #1a3a52, #0d1f2d); display: flex; align-items: center; justify-content: center; color: #888;">
                        Obraz wiadomo≈õci
                    </div>
                    <div style="padding: 1.5rem;">
                        <h3 style="color: white; font-size: 1.2rem; margin: 0 0 1rem 0; line-height: 1.4;">${news.title}</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; color: #888; font-size: 0.85rem;">
                            <span>${news.source}</span>
                            <span>${news.time}</span>
                        </div>
                    </div>
                </div>
            `;
        } else {
            html += `
                <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); border-radius: 8px; padding: 1rem; display: flex; gap: 1rem;">
                    <div style="width: 100px; height: 80px; background: linear-gradient(135deg, #1a3a52, #0d1f2d); border-radius: 4px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: #888; font-size: 0.8rem;">
                        Zdjƒôcie
                    </div>
                    <div style="flex: 1;">
                        <h4 style="color: white; margin: 0 0 0.5rem 0; font-size: 0.95rem; line-height: 1.3;">${news.title}</h4>
                        <div style="display: flex; justify-content: space-between; align-items: center; color: #888; font-size: 0.8rem;">
                            <span>${news.source}</span>
                            <span>${news.time}</span>
                        </div>
                    </div>
                </div>
            `;
        }
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function displayClubSquad() {
    const container = document.getElementById('squad-content');
    const squad = [
        { name: 'Mariusz Misiura', position: 'Trener', country: 'Polska', number: '', age: 44, height: '', value: '' },
        { name: 'Jakub Burek', position: 'B', country: 'Polska', number: '22', age: 22, height: '188 cm', value: '425,6 tys. ‚Ç¨' },
        { name: 'Oskar K≈Çat', position: 'B', country: 'Polska', number: '18', age: 18, height: '191 cm', value: '15 tys. ‚Ç¨' },
        { name: 'Stanis≈Çaw Pruszkowski', position: 'B', country: 'Polska', number: '1', age: 21, height: '198 cm', value: '' },
        { name: 'Rafa≈Ç Leszczynski', position: 'B', country: 'Polska', number: '12', age: 33, height: '187 cm', value: '337,6 tys. ‚Ç¨' },
        { name: 'Maciej Gostomski', position: 'B', country: 'Polska', number: '33', age: 37, height: '190 cm', value: '149,1 tys. ‚Ç¨' },
        { name: 'Oskar Lodzinski', position: 'B', country: 'Polska', number: '93', age: 21, height: '191 cm', value: '30 tys. ‚Ç¨' },
        { name: 'Zan Rogelj', position: 'PO, PP, PSO, PS', country: 'S≈Çowenia', number: '21', age: 26, height: '170 cm', value: '667,6 tys. ‚Ç¨' }
    ];
    
    let html = `
        <table style="width: 100%; border-collapse: collapse; color: white;">
            <thead>
                <tr style="background: rgba(0, 50, 100, 0.3); border-bottom: 2px solid rgba(0, 170, 255, 0.2);">
                    <th style="padding: 1rem; text-align: left; color: #888; font-weight: normal; font-size: 0.9rem;">GRACZ</th>
                    <th style="padding: 1rem; text-align: left; color: #888; font-weight: normal; font-size: 0.9rem;">POZYCJA</th>
                    <th style="padding: 1rem; text-align: left; color: #888; font-weight: normal; font-size: 0.9rem;">KRAJ</th>
                    <th style="padding: 1rem; text-align: center; color: #888; font-weight: normal; font-size: 0.9rem;">NR</th>
                    <th style="padding: 1rem; text-align: center; color: #888; font-weight: normal; font-size: 0.9rem;">WIEK</th>
                    <th style="padding: 1rem; text-align: center; color: #888; font-weight: normal; font-size: 0.9rem;">WZROST</th>
                    <th style="padding: 1rem; text-align: right; color: #888; font-weight: normal; font-size: 0.9rem;">WARTO≈öƒÜ RYNKOWA</th>
                </tr>
            </thead>
            <tbody>`;
    
    squad.forEach(player => {
        html += `
            <tr style="border-bottom: 1px solid rgba(0, 170, 255, 0.1);">
                <td style="padding: 1rem; color: white; font-weight: 600;">${player.name}</td>
                <td style="padding: 1rem; color: #aaa;">${player.position}</td>
                <td style="padding: 1rem; color: #aaa; display: flex; align-items: center; gap: 0.5rem;">
                    <span style="font-size: 1rem;">üáµüá±</span> ${player.country}
                </td>
                <td style="padding: 1rem; text-align: center; color: #aaa;">${player.number || '-'}</td>
                <td style="padding: 1rem; text-align: center; color: #aaa;">${player.age || '-'}</td>
                <td style="padding: 1rem; text-align: center; color: #aaa;">${player.height || '-'}</td>
                <td style="padding: 1rem; text-align: right; color: #aaa;">${player.value || '-'}</td>
            </tr>
        `;
    });
    
    html += `
            </tbody>
        </table>
    `;
    
    container.innerHTML = html;
}

function displayClubTrophies() {
    const container = document.getElementById('trophies-content');
    const trophies = [
        { name: '1 Liga', type: 'Wicemistrz', count: 1, emoji: 'ü•á' },
        { name: 'Superpuchar Polski', type: 'Mistrz', count: 1, emoji: 'üß°' },
        { name: 'Cup', type: 'Mistrz', count: 1, emoji: 'üîµ' },
        { name: 'Ekstraklasa', type: 'Mistrz', count: 0, emoji: '‚ö™' }
    ];
    
    let html = '';
    
    trophies.forEach(trophy => {
        html += `
            <div style="background: rgba(0, 50, 100, 0.3); border: 1px solid rgba(0, 170, 255, 0.2); border-radius: 8px; padding: 2rem; text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">${trophy.emoji}</div>
                <div style="color: white; font-weight: bold; font-size: 1.2rem; margin-bottom: 0.5rem;">${trophy.name}</div>
                <div style="color: #888; font-size: 0.9rem; margin-bottom: 1.5rem;">${trophy.type}</div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <span style="color: #00aaff; font-weight: bold; font-size: 1.3rem;">${trophy.count}</span>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function loadSidebarTabela() {
    const container = document.getElementById('sidebar-content');
    let html = `
        <table class="compact-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Klub</th>
                    <th>M</th>
                    <th>Pkt</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    tabela.forEach((team, index) => {
        const druzyna = druzyny.find(d => d.id === team.id);
        const logo = druzyna ? druzyna.logo : '';
        html += `
            <tr>
                <td class="pos">${index + 1}</td>
                <td>
                    <div class="team-flex">
                        <img src="${logo}" alt="${team.nazwa}">
                        <span>${druzyna ? druzyna.skrot : team.nazwa.substring(0,3).toUpperCase()}</span>
                    </div>
                </td>
                <td>${team.mecze}</td>
                <td><strong>${team.punkty}</strong></td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}

function getTeamShortcut(teamName) {
    const team = druzyny.find(d => d.nazwa === teamName);
    return team ? team.skrot : teamName.substring(0, 3).toUpperCase();
}

let currentScheduleMode = 'kolejka';
let rrScheduleData = null;
let rrCurrentRound = 1;

function generateRoundRobinSchedule() {
    const teams = druzyny.map(t => ({ id: t.id, nazwa: t.nazwa, skrot: t.skrot }));
    const numTeams = teams.length;
    const rounds = [];
    
    for (let round = 0; round < numTeams - 1; round++) {
        const matches = [];
        
        for (let i = 0; i < numTeams / 2; i++) {
            let homeIdx = i;
            let awayIdx = numTeams - 1 - i;
            
            if (round % 2 === 0) {
                const temp = homeIdx;
                homeIdx = awayIdx;
                awayIdx = temp;
            }
            
            const rotated = (round + numTeams - 1) % (numTeams - 1);
            let home = (homeIdx + rotated) % numTeams;
            let away = (awayIdx + rotated) % numTeams;
            
            if (home !== away) {
                const homeTeam = teams[home];
                const awayTeam = teams[away];
                
                matches.push({
                    home: homeTeam.nazwa,
                    away: awayTeam.nazwa,
                    homeShort: homeTeam.skrot,
                    awayShort: awayTeam.skrot,
                    time: '15:00'
                });
            }
        }
        
        if (matches.length > 0) {
            rounds.push({
                round: round + 1,
                matches: matches
            });
        }
    }
    
    return rounds;
}

function switchScheduleMode(mode) {
    currentScheduleMode = mode;
    const modeKolejkaBtn = document.getElementById('mode-kolejka');
    const modeRrBtn = document.getElementById('mode-rr');
    const headerNav = document.getElementById('schedule-header-nav');
    
    modeKolejkaBtn.style.color = mode === 'kolejka' ? 'white' : '#888';
    modeKolejkaBtn.style.borderBottomColor = mode === 'kolejka' ? '#00aaff' : 'transparent';
    modeRrBtn.style.color = mode === 'rr' ? 'white' : '#888';
    modeRrBtn.style.borderBottomColor = mode === 'rr' ? '#00aaff' : 'transparent';
    
    if (mode === 'rr') {
        rrScheduleData = generateRoundRobinSchedule();
        rrCurrentRound = 1;
        loadRoundRobinSchedule();
    } else {
        loadSidebarTerminarz();
    }
}

function loadRoundRobinSchedule() {
    const container = document.getElementById('schedule-content');
    const headerNav = document.getElementById('schedule-header-nav');
    const roundTitle = document.getElementById('round-title');
    
    roundTitle.textContent = `${rrCurrentRound}. KOLEJKA`;
    
    const currentRoundData = rrScheduleData[rrCurrentRound - 1];
    if (!currentRoundData) return;
    
    let html = '<div style="display: flex; flex-direction: column; gap: 1.5rem;">';
    
    currentRoundData.matches.forEach(match => {
        const homeTeam = druzyny.find(t => t.skrot === match.homeShort);
        const awayTeam = druzyny.find(t => t.skrot === match.awayShort);
        const homeLogo = homeTeam ? homeTeam.logo : '';
        const awayLogo = awayTeam ? awayTeam.logo : '';
        
        html += `
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.8rem 0.5rem; background: rgba(0, 50, 100, 0.2); border: 1px solid rgba(0, 170, 255, 0.1); border-radius: 4px; margin-bottom: 0.5rem; font-size: 0.85rem;">
                <div style="display: flex; align-items: center; gap: 0.4rem; flex: 1;">
                    <img src="${homeLogo}" alt="" style="height: 18px; width: auto;">
                    <span style="color: white; min-width: 40px;">${match.home}</span>
                </div>
                <div style="text-align: center; color: #00aaff; font-weight: bold; padding: 0 0.8rem;">${match.time}</div>
                <div style="display: flex; align-items: center; gap: 0.4rem; flex: 1; justify-content: flex-end;">
                    <span style="color: white; text-align: right; min-width: 40px;">${match.away}</span>
                    <img src="${awayLogo}" alt="" style="height: 18px; width: auto;">
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function loadSidebarTerminarz() {
    const container = document.getElementById('sidebar-content');
    let html = '<div id="countdown-placeholder"></div>';
    
    const meczByRound = {
        19: [
            { date: 'PiƒÖtek, 30 stycznia', time: '', matches: [
                { home: 'Zag≈Çƒôbie Lubin', away: 'GKS Katowice', homeShort: 'ZAG', awayShort: 'GKS', league: 'Ekstraklasa', time: '18:00' },
                { home: 'Lech Pozna≈Ñ', away: 'Lechia Gda≈Ñsk', homeShort: 'LPO', awayShort: 'LGD', league: 'Ekstraklasa', time: '20:30' }
            ]},
            { date: 'Sobota, 31 stycznia', time: '', matches: [
                { home: 'Radomiak Radom', away: 'Arka Gdynia', homeShort: 'RAD', awayShort: 'ARK', league: 'Ekstraklasa', time: '14:45' },
                { home: 'Widzew ≈Å√≥d≈∫', away: 'Jagiellonia Bia≈Çystok', homeShort: 'WID', awayShort: 'JAG', league: 'Ekstraklasa', time: '17:30' },
                { home: 'G√≥rnik Zabrze', away: 'Piast Gliwice', homeShort: 'GOR', awayShort: 'PIA', league: 'Ekstraklasa', time: '20:15' }
            ]},
            { date: 'Niedziela, 1 lutego', time: '', matches: [
                { home: 'Motor Lublin', away: 'Pogo≈Ñ Szczecin', homeShort: 'MOT', awayShort: 'POG', league: 'Ekstraklasa', time: '12:15' },
                { home: 'Wis≈Ça P≈Çock', away: 'Rak√≥w Czƒôstochowa', homeShort: 'WIS', awayShort: 'RAK', league: 'Ekstraklasa', time: '14:45' },
                { home: 'Legia Warszawa', away: 'Korona Kielce', homeShort: 'LEG', awayShort: 'KOR', league: 'Ekstraklasa', time: '17:30' }
            ]},
            { date: 'Poniedzia≈Çek, 2 lutego', time: '', matches: [
                { home: 'Termalica Nieciecza', away: 'Cracovia', homeShort: 'TER', awayShort: 'CRA', league: 'Ekstraklasa', time: '19:00' }
            ]}
        ]
    };
    
    const currentRound = 19;
    const round = meczByRound[currentRound];
    
    html += `<div style="padding: 1rem 0; border-bottom: 2px solid rgba(0, 170, 255, 0.3); margin-bottom: 1rem;">
        <div style="color: white; font-size: 1.1rem; font-weight: bold;">Kolejka ${currentRound} <span style="float: right;">‚Üí</span></div>
    </div>`;
    
    html += '<div style="display: flex; flex-direction: column; gap: 1.5rem;">';
    
    round.forEach(dayGroup => {
        html += `<div>
            <div style="color: #888; font-size: 0.9rem; text-transform: uppercase; margin-bottom: 0.8rem; padding: 0 0.5rem;">${dayGroup.date}</div>`;
        
        dayGroup.matches.forEach(match => {
            const homeTeam = druzyny.find(t => t.skrot === match.homeShort);
            const awayTeam = druzyny.find(t => t.skrot === match.awayShort);
            const homeLogo = homeTeam ? homeTeam.logo : '';
            const awayLogo = awayTeam ? awayTeam.logo : '';
            
            html += `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.8rem 0.5rem; background: rgba(0, 50, 100, 0.2); border: 1px solid rgba(0, 170, 255, 0.1); border-radius: 4px; margin-bottom: 0.5rem; font-size: 0.85rem;">
                    <div style="display: flex; align-items: center; gap: 0.4rem; flex: 1;">
                        <img src="${homeLogo}" alt="" style="height: 18px; width: auto;">
                        <span style="color: white; min-width: 40px;">${match.home}</span>
                    </div>
                    <div style="text-align: center; color: #00aaff; font-weight: bold; padding: 0 0.8rem;">${match.time}</div>
                    <div style="display: flex; align-items: center; gap: 0.4rem; flex: 1; justify-content: flex-end;">
                        <span style="color: white; text-align: right; min-width: 40px;">${match.away}</span>
                        <img src="${awayLogo}" alt="" style="height: 18px; width: auto;">
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
    });
    
    html += '</div>';
    container.innerHTML = html;
    startCountdown();
}

function startCountdown() {
    const placeholder = document.getElementById('countdown-placeholder');
    if (!placeholder) return;

    // Find next match (mocking one for demo purposes if all are past)
    // For demo, let's set a match 3 days from now
    const now = new Date();
    const nextMatchDate = new Date(now.getTime() + (3 * 24 * 60 * 60 * 1000) + (5 * 60 * 60 * 1000)); // 3 days 5 hours from now
    
    // Mock teams for the next match
    const homeTeam = druzyny[7]; // Zag≈Çƒôbie Lubin
    const awayTeam = druzyny[6]; // Lechia Gda≈Ñsk

    placeholder.innerHTML = `
        <div style="display: flex; align-items: stretch; height: 150px; border-radius: 4px; overflow: hidden;">
            <div style="background: url('https://i.ibb.co/B5JxR704/obraz-2025-12-21-221127165.png') center/cover; flex: 0 0 40%; display: flex; flex-direction: column; justify-content: center; padding: 2rem; color: white;">
                <div style="font-size: 0.85rem; text-transform: uppercase; color: #aaa; margin-bottom: 0.5rem;">AZTOR–ò–ù</div>
                <div style="font-size: 1.1rem; font-weight: bold; text-transform: uppercase; margin-bottom: 1rem;">Odlicza czas do nastƒôpnego meczu</div>
            </div>
            <div style="background: #1a1a1a; flex: 1; display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; position: relative;">
                <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <img src="${homeTeam.logo}" alt="${homeTeam.nazwa}" style="height: 60px; width: auto;">
                    <div style="color: white; font-weight: bold; font-size: 0.9rem;">${homeTeam.skrot}</div>
                </div>
                
                <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                    <div style="color: white; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; color: #888;">${nextMatchDate.toLocaleDateString('pl-PL')}</div>
                    <div style="color: #00aaff; font-weight: bold; font-size: 2.5rem; font-family: 'Courier New', monospace; letter-spacing: 2px;" id="timer">00:00:00:00</div>
                    <div style="display: flex; gap: 1rem; font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px;">
                        <span>DNI</span>
                        <span>GODZ</span>
                        <span>MIN</span>
                        <span>SEK</span>
                    </div>
                </div>
                
                <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <img src="${awayTeam.logo}" alt="${awayTeam.nazwa}" style="height: 60px; width: auto;">
                    <div style="color: white; font-weight: bold; font-size: 0.9rem;">${awayTeam.skrot}</div>
                </div>
            </div>
        </div>
    `;

    function updateTimer() {
        const currentTime = new Date().getTime();
        const distance = nextMatchDate.getTime() - currentTime;

        if (distance < 0) {
            document.getElementById("timer").innerHTML = "MECZ TRWA";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("timer").innerHTML = 
            (days < 10 ? "0" + days : days) + ":" + 
            (hours < 10 ? "0" + hours : hours) + ":" + 
            (minutes < 10 ? "0" + minutes : minutes) + ":" + 
            (seconds < 10 ? "0" + seconds : seconds);
    }

    setInterval(updateTimer, 1000);
    updateTimer();
}

function loadSidebarKluby() {
    const container = document.getElementById('sidebar-content');
    let html = '<div style="display: flex; flex-direction: column; gap: 8px; padding: 8px 0;">';
    
    druzyny.forEach(team => {
        const stats = tabela.find(t => t.id === team.id);
        const points = stats ? stats.punkty : 0;
        
        html += `
            <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: rgba(0,0,0,0.6); border-radius: 4px; cursor: pointer; transition: all 0.3s;" 
                 onmouseover="this.style.background='rgba(0,86,179,0.3)'" 
                 onmouseout="this.style.background='rgba(0,0,0,0.6)'"
                 onclick="showClubProfile(${team.id})">
                <img src="${team.logo}" alt="${team.nazwa}" style="height: 28px; width: auto; flex-shrink: 0;">
                <div style="flex: 1; min-width: 0;">
                    <div style="font-size: 0.8rem; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: white;">${team.skrot}</div>
                    <div style="font-size: 0.7rem; color: #aaa;">${points} pkt</div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function changeLeague(league) {
    if (league === 'ekstraklasa') {
        tabela = tablekaEkstraklasa;
        currentLeague = 'ekstraklasa';
    } else if (league === '1liga') {
        tabela = tabela1Liga;
        currentLeague = '1liga';
    }
    renderFullTable('all');
}

function filterTable(type, btn) {
    // Update active button
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    renderFullTable(type);
}

function renderFullTable(filterType = 'all') {
    const container = document.getElementById('full-table-content');
    let html = `
        <table class="full-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th style="text-align: left;">DRU≈ªYNA</th>
                    <th>M</th>
                    <th>Z</th>
                    <th>R</th>
                    <th>P</th>
                    <th>+/-</th>
                    <th>=</th>
                    <th>PKT.</th>
                    <th style="text-align: left;">Forma</th>
                    <th style="text-align: left;">Nastƒôpna Kolejka</th>
                </tr>
            </thead>
            <tbody>
    `;

    // Create a deep copy of the table to avoid modifying the original data permanently during live updates
    let displayTable = JSON.parse(JSON.stringify(tabela));

    // Apply live match updates if active
    if (lastValidMatchData && lastValidMatchData.active) {
        const teamA = displayTable.find(t => t.nazwa === lastValidMatchData.teamA.nazwa);
        const teamB = displayTable.find(t => t.nazwa === lastValidMatchData.teamB.nazwa);

        if (teamA && teamB) {
            teamA.isPlaying = true;
            teamB.isPlaying = true;

            // Update stats temporarily
            teamA.mecze += 1;
            teamB.mecze += 1;
            
            teamA.bramkiZa += lastValidMatchData.teamA.score;
            teamA.bramkiProti += lastValidMatchData.teamB.score;
            
            teamB.bramkiZa += lastValidMatchData.teamB.score;
            teamB.bramkiProti += lastValidMatchData.teamA.score;

            if (lastValidMatchData.teamA.score > lastValidMatchData.teamB.score) {
                teamA.punkty += 3;
                teamA.wygrane += 1;
                teamB.przegrane += 1;
            } else if (lastValidMatchData.teamA.score < lastValidMatchData.teamB.score) {
                teamB.punkty += 3;
                teamB.wygrane += 1;
                teamA.przegrane += 1;
            } else {
                teamA.punkty += 1;
                teamB.punkty += 1;
                teamA.remisy += 1;
                teamB.remisy += 1;
            }
        }
    }

    // Sort table based on points (descending)
    const sortedTabela = displayTable.sort((a, b) => {
        const statsA = filterType === 'home' ? a.domowe : (filterType === 'away' ? a.wyjazdowe : a);
        const statsB = filterType === 'home' ? b.domowe : (filterType === 'away' ? b.wyjazdowe : b);
        return statsB.punkty - statsA.punkty;
    });

    sortedTabela.forEach((team, index) => {
        const druzyna = druzyny.find(d => d.id === team.id);
        const logo = druzyna ? druzyna.logo : '';
        
        // Select stats based on filter
        let stats = team;
        if (filterType === 'home') stats = team.domowe;
        if (filterType === 'away') stats = team.wyjazdowe;

        let formHtml = '<div style="display: flex; gap: 0.3rem;">';
        const formResults = ['W', 'Z', 'R', 'W', 'Z'];
        formResults.forEach(result => {
            let bgColor = '';
            let labelText = '';
            if (result === 'W') { bgColor = '#4caf50'; labelText = 'W'; }
            else if (result === 'Z') { bgColor = '#f44336'; labelText = 'P'; }
            else if (result === 'R') { bgColor = '#ff9800'; labelText = 'R'; }
            formHtml += `<div style="background: ${bgColor}; color: white; padding: 0.3rem 0.5rem; border-radius: 2px; font-size: 0.7rem; font-weight: bold; text-align: center; min-width: 20px;">${labelText}</div>`;
        });
        formHtml += '</div>';
        
        const nextMatches = {
            'Legia Warszawa': { opponent: 'Pogon Szczecin', home: false },
            'Lech Pozna≈Ñ': { opponent: 'Arka Gdynia', home: true },
            'Pogo≈Ñ Szczecin': { opponent: 'Lechia Gda≈Ñsk', home: true },
            'Arka Gdynia': { opponent: 'Zag≈Çƒôbie Lubin', home: false },
            'Lechia Gda≈Ñsk': { opponent: 'Zawisza Bydgoszcz', home: false },
            'Zag≈Çƒôbie Lubin': { opponent: 'Lech Pozna≈Ñ', home: true },
            'Zawisza Bydgoszcz': { opponent: 'Legia Warszawa', home: true },
            'Unia Sienkiewicze': { opponent: 'Arka Gdynia', home: true }
        };
        const nextMatch = nextMatches[team.nazwa] || { opponent: '-', home: false };
        const nextMatchOpponent = druzyny.find(d => d.nazwa === nextMatch.opponent);
        const nextMatchLogo = nextMatchOpponent ? nextMatchOpponent.logo : '';
        const homeAway = nextMatch.home ? 'U' : 'W';
        const nextMatchHtml = `<div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem;">
            ${nextMatchLogo ? `<img src="${nextMatchLogo}" alt="${nextMatch.opponent}" style="width: 20px; height: 20px; object-fit: contain;">` : ''}
            <span>${homeAway} ${nextMatch.opponent}</span>
        </div>`;

        const isRelegation = index >= sortedTabela.length - 3;
        let trClass = isRelegation ? 'class="relegation-row"' : '';
        
        if (team.isPlaying) {
            trClass = 'class="live-match-row" style="background: rgba(0, 170, 255, 0.15); border-left: 3px solid #00aaff;"';
        }

        const goalDiff = stats.bramkiZa - stats.bramkiProti;
        const goalDiffColor = goalDiff > 0 ? '#4caf50' : (goalDiff < 0 ? '#f44336' : '#888');
        
        html += `
            <tr ${trClass}>
                <td class="pos-cell" style="padding: 0.8rem 0.5rem; text-align: center; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${index === 0 ? 'üèÜ ' : ''}${index + 1}</td>
                <td class="team-cell" style="padding: 0.8rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1); display: flex; align-items: center; gap: 0.8rem;">
                    <img src="${logo}" alt="${team.nazwa}" style="width: 28px; height: 28px; object-fit: contain;">
                    <span style="min-width: 150px;">${team.nazwa}</span>
                    ${team.isPlaying ? '<span style="color: #ff4444; font-size: 0.65rem; font-weight: bold; background: rgba(255, 0, 0, 0.2); padding: 0.2rem 0.4rem; border-radius: 2px;">‚óèLIVE</span>' : ''}
                </td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${stats.mecze}</td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${stats.wygrane}</td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${stats.remisy}</td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${stats.przegrane}</td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1); color: ${goalDiffColor}; font-weight: bold;">${goalDiff > 0 ? '+' : ''}${goalDiff}</td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${stats.bramkiZa}:${stats.bramkiProti}</td>
                <td style="text-align: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1); color: #00aaff; font-weight: bold; font-size: 1.1rem;">${stats.punkty}</td>
                <td style="padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1);">${formHtml}</td>
                <td style="padding: 0.8rem 0.5rem; border-bottom: 1px solid rgba(0, 170, 255, 0.1); color: #aaa;">${nextMatchHtml}</td>
            </tr>
        `;
    });

    html += '</tbody></table>';
    container.innerHTML = html;
}

function switchSidebar(tab) {
    const tabs = document.querySelectorAll('.sidebar-tab');
    tabs.forEach(t => t.classList.remove('active'));
    
    if (tab === 'terminarz') {
        tabs[0].classList.add('active');
        loadSidebarTerminarz();
    } else if (tab === 'tabela') {
        tabs[1].classList.add('active');
        loadSidebarTabela();
    }
}

function formatDate(dateString) {
    const options = { day: 'numeric', month: 'numeric', year: 'numeric' };
    return new Date(dateString).toLocaleDateString('pl-PL', options);
}

function loadTicker() {
    const container = document.getElementById('clubs-ticker');
    let html = '';
    
    // Duplicate for infinite scroll effect (simplified)
    const allTeams = [...druzyny, ...druzyny];
    
    allTeams.forEach(team => {
        html += `
            <div class="ticker-item">
                <img src="${team.logo}" alt="${team.nazwa}">
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function openModal(teamId) {
    const modal = document.getElementById('club-modal');
    const modalBody = document.getElementById('modal-body');
    const team = druzyny.find(d => d.id === teamId);
    const stats = tabela.find(t => t.id === teamId);
    
    if (!team || !stats) return;
    
    modalBody.innerHTML = `
        <div class="modal-header">
            <img src="${team.logo}" alt="${team.nazwa}" class="modal-logo">
            <h2>${team.nazwa}</h2>
        </div>
        <div class="modal-stats">
            <div class="stat-box">
                <div class="stat-value">${stats.mecze}</div>
                <div class="stat-label">Mecze</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">${stats.punkty}</div>
                <div class="stat-label">Punkty</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">${stats.wygrane}</div>
                <div class="stat-label">Zwyciƒôstwa</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">${stats.przegrane}</div>
                <div class="stat-label">Pora≈ºki</div>
            </div>
        </div>
    `;
    modal.style.display = 'block';
}

function closeModal() {
    document.getElementById('club-modal').style.display = 'none';
}

function scrollToSidebar() {
    showLeaguesModal();
}

function showLeaguesModal() {
    const modal = document.getElementById('club-modal');
    const modalBody = document.getElementById('modal-body');
    
    modalBody.innerHTML = `
        <div style="text-align: center;">
            <h2 style="margin-bottom: 2rem; color: white;">WYBIERZ ROZGRYWKƒò</h2>
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <button onclick="selectLeague('7u7-ekstraklasa')" style="padding: 1rem; background: transparent; border: 2px solid #0056b3; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 1rem;">
                    <img src="https://i.ibb.co/fgf9xk7/ekstraklasabaner-removebg-preview.png" alt="Ekstraklasa" style="height: 60px; object-fit: contain;">
                </button>
                <button onclick="selectLeague('1liga')" style="padding: 1rem; background: transparent; border: 2px solid #0056b3; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 1rem;">
                    <img src="https://i.ibb.co/7JnQJNz2/obraz-2025-12-19-145450497.png" alt="1. Liga" style="height: 60px; object-fit: contain;">
                </button>
                <button onclick="selectLeague('7u7-puchar-polski')" style="padding: 1rem; background: transparent; border: 2px solid #0056b3; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 1rem;">
                    <img src="https://i.ibb.co/FkyfzY94/2d771fb9-cae8-4073-b874-7b2487c970bd.png" alt="7U7 Puchar Polski" style="height: 60px; object-fit: contain;">
                </button>
            </div>
        </div>
    `;
    modal.style.display = 'block';
}

function selectLeague(league) {
    document.getElementById('club-modal').style.display = 'none';
    
    if (league === '7u7-puchar-polski') {
        showView('cup-bracket');
        loadCupBracket();
    } else if (league === '1liga') {
        tabela = tabela1Liga;
        currentLeague = '1liga';
        showView('table');
        renderFullTable();
    } else if (league === '7u7-ekstraklasa') {
        tabela = tablekaEkstraklasa;
        currentLeague = 'ekstraklasa';
        showView('table');
        renderFullTable();
    }
}

function loadCupBracket() {
    const container = document.getElementById('bracket-content');
    
    const teams = Array(16).fill('');
    
    let html = `
        <style>
            .bracket-wrapper {
                display: flex;
                gap: 2rem;
                justify-content: space-between;
                align-items: center;
                width: 100%;
                min-height: 600px;
            }
            
            .bracket-round {
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                flex-shrink: 0;
            }
            
            .match-box {
                background: rgba(0,0,0,0.6);
                border: 1px solid #0056b3;
                border-radius: 4px;
                padding: 0.8rem;
                min-width: 140px;
                position: relative;
            }
            
            .match-box::after {
                content: '';
                position: absolute;
                right: -1rem;
                top: 50%;
                width: 1rem;
                height: 1px;
                background: #0056b3;
                transform: translateY(-50%);
            }
            
            .match-box.final::after {
                display: none;
            }
            
            .team-slot {
                color: #aaa;
                font-size: 0.75rem;
                padding: 0.3rem 0;
                text-align: center;
                min-height: 16px;
                border-bottom: 1px solid #0056b3;
            }
            
            .team-slot:last-child {
                border-bottom: none;
            }
            
            .vs-text {
                color: #0056b3;
                font-size: 0.65rem;
                text-align: center;
                padding: 0.2rem 0;
                font-weight: bold;
            }
            
            .round-title {
                text-align: center;
                color: #00aaff;
                font-size: 0.85rem;
                margin-bottom: 2rem;
                font-weight: bold;
                text-transform: uppercase;
            }
            
            .finals-section {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 1rem;
            }
            
            .champion-text {
                color: #00aaff;
                font-size: 1rem;
                font-weight: bold;
                text-transform: uppercase;
                margin-top: 2rem;
            }
        </style>
        
        <div class="bracket-wrapper">
            <!-- LEFT SIDE (8 Teams) -->
            <div>
                <div class="round-title">1/8 FINA≈ÅU</div>
                <div class="bracket-round" style="gap: 2.5rem;">
                    ${Array(4).fill(0).map((_, i) => `
                        <div class="match-box">
                            <div class="team-slot">---</div>
                            <div class="vs-text">VS</div>
                            <div class="team-slot">---</div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- 1/4 FINALS -->
            <div>
                <div class="round-title">1/4 FINA≈ÅU</div>
                <div class="bracket-round" style="gap: 5rem;">
                    ${Array(2).fill(0).map((_, i) => `
                        <div class="match-box">
                            <div class="team-slot">---</div>
                            <div class="vs-text">VS</div>
                            <div class="team-slot">---</div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- SEMI-FINALS & FINALS (CENTER) -->
            <div class="finals-section">
                <div style="display: flex; flex-direction: column; gap: 8rem; align-items: center;">
                    <div class="match-box">
                        <div class="team-slot">---</div>
                        <div class="vs-text">VS</div>
                        <div class="team-slot">---</div>
                    </div>
                    <div class="match-box final">
                        <div class="team-slot">---</div>
                        <div class="vs-text">VS</div>
                        <div class="team-slot">---</div>
                    </div>
                    <div class="match-box final">
                        <div class="team-slot">ZWYCIƒòZCA</div>
                    </div>
                </div>
            </div>
            
            <!-- SEMI-FINALS & FINALS (CENTER) - RIGHT SIDE MIRROR -->
            <div class="finals-section">
                <div style="display: flex; flex-direction: column; gap: 8rem; align-items: center;">
                    <div class="match-box">
                        <div class="team-slot">---</div>
                        <div class="vs-text">VS</div>
                        <div class="team-slot">---</div>
                    </div>
                </div>
            </div>
            
            <!-- 1/4 FINALS RIGHT -->
            <div>
                <div class="round-title">1/4 FINA≈ÅU</div>
                <div class="bracket-round" style="gap: 5rem;">
                    ${Array(2).fill(0).map((_, i) => `
                        <div class="match-box">
                            <div class="team-slot">---</div>
                            <div class="vs-text">VS</div>
                            <div class="team-slot">---</div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- RIGHT SIDE (8 Teams) -->
            <div>
                <div class="round-title">1/8 FINA≈ÅU</div>
                <div class="bracket-round" style="gap: 2.5rem;">
                    ${Array(4).fill(0).map((_, i) => `
                        <div class="match-box">
                            <div class="team-slot">---</div>
                            <div class="vs-text">VS</div>
                            <div class="team-slot">---</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        
        <div class="champion-text" style="text-align: center; margin-top: 3rem;">
            üèÜ PUCHAR POLSKI üèÜ
        </div>
    `;
    
    container.innerHTML = html;
}

let matchState = {
    seconds: 0,
    isRunning: false,
    interval: null,
    isFinished: false
};

function updateMatchTimer() {
    const minutes = Math.floor(matchState.seconds / 60);
    const secs = matchState.seconds % 60;
    
    if (minutes >= 40) {
        pauseMatch();
        return;
    }
    
    const period = minutes >= 20 ? 'Druga po≈Çowa' : 'Pierwsza po≈Çowa';
    document.getElementById('match-timer').textContent = `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
    document.getElementById('match-period').textContent = minutes === 20 ? 'PRZERWA' : period;
}

function startMatch() {
    if (matchState.isRunning) return;
    
    matchState.isRunning = true;
    matchState.interval = setInterval(() => {
        matchState.seconds++;
        updateMatchTimer();
    }, 1000);
}

function pauseMatch() {
    matchState.isRunning = false;
    if (matchState.interval) clearInterval(matchState.interval);
}

function resetMatch() {
    pauseMatch();
    matchState.seconds = 0;
    updateMatchTimer();
    clearEvents();
}

let matchEvents = {
    'team-a': [],
    'team-b': []
};

function getEventIcon(type) {
    const icons = {
        'goal': '‚öΩ',
        'yellow': 'üü°',
        'red': 'üî¥',
        'substitution': 'üîÑ'
    };
    return icons[type] || '';
}

function getEventLabel(type) {
    const labels = {
        'goal': 'Gol',
        'yellow': '≈ª√≥≈Çta kartka',
        'red': 'Czerwona kartka',
        'substitution': 'Zmiana'
    };
    return labels[type] || '';
}

function addEvent(team, type) {
    const minutes = Math.floor(matchState.seconds / 60);
    const event = {
        type: type,
        minute: minutes,
        time: `${minutes}'`
    };
    
    matchEvents[team].push(event);
    updateEventsDisplay();
}

function updateEventsDisplay() {
    ['team-a', 'team-b'].forEach(team => {
        const container = document.getElementById(`${team}-events`);
        if (!matchEvents[team] || matchEvents[team].length === 0) {
            container.innerHTML = '<div style="color: #666;">Brak zdarze≈Ñ</div>';
        } else {
            container.innerHTML = matchEvents[team]
                .map((event, i) => `
                    <div style="color: white; padding: 0.5rem; background: rgba(0,170,255,0.1); margin-bottom: 0.5rem; border-radius: 3px; display: flex; justify-content: space-between; align-items: center;">
                        <span>${event.time} - ${getEventLabel(event.type)}</span>
                        <span>${getEventIcon(event.type)}</span>
                        <button onclick="removeEvent('${team}', ${i})" style="background: #dc3545; color: white; border: none; border-radius: 3px; padding: 0.2rem 0.5rem; cursor: pointer; font-size: 0.8rem;">X</button>
                    </div>
                `)
                .join('');
        }
    });
}

function removeEvent(team, index) {
    matchEvents[team].splice(index, 1);
    updateEventsDisplay();
}

function clearEvents() {
    matchEvents['team-a'] = [];
    matchEvents['team-b'] = [];
    updateEventsDisplay();
}

function endMatch() {
    pauseMatch();
    matchState.isFinished = true;
    document.getElementById('match-period').textContent = 'Mecz zako≈Ñczony';
}

function addEventToMatch(eventData) {
    if (!eventData || !eventData.type || !eventData.team) return;
    
    const team = eventData.team === 'A' ? 'team-a' : 'team-b';
    const minutes = eventData.timestamp ? parseInt(eventData.timestamp) : Math.floor(matchState.seconds / 60);
    
    const event = {
        type: eventData.type,
        minute: minutes,
        time: `${minutes}'`,
        description: eventData.description
    };
    
    matchEvents[team].push(event);
    updateEventsDisplay();
}

window.onclick = function(event) {
    const modal = document.getElementById('club-modal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadStoredMatchData();
    loadNews();
    loadSidebarTerminarz();
    loadTicker();
    loadMainCountdown();
    renderSchedule();
});

function playGoalSound() {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(784, audioContext.currentTime + 0.1);
    
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0, audioContext.currentTime + 0.5);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
}

function displayFactsTab() {
    const container = document.getElementById('facts-content');
    if (!container) return;
    
    fetchApi('/api/matches?t=' + Date.now())
        .then(allMatches => {
            const teamAName = currentMatchTeamA?.nazwa;
            const teamBName = currentMatchTeamB?.nazwa;
            
            console.log('[FACTS] Szukam meczu:', teamAName, 'vs', teamBName);
            console.log('[FACTS] Wszystkie miecze z API:', allMatches);
            
            let matchData = null;
            if (Array.isArray(allMatches)) {
                matchData = allMatches.find(m => 
                    (m.teamA === teamAName && m.teamB === teamBName) ||
                    (m.teamA === teamBName && m.teamB === teamAName)
                );
            }
            
            console.log('[FACTS] matchData:', matchData);
            console.log('[FACTS] events:', matchData?.events);
            console.log('[FACTS] goals:', matchData?.events?.goals);
            console.log('[FACTS] substitutions:', matchData?.events?.substitutions);
            console.log('[FACTS] cards:', matchData?.events?.cards);
            
            let html = '<div style="display: flex; flex-direction: column; gap: 0;">';
            html += '<h3 style="margin-bottom: 1.5rem; color: #00aaff; text-transform: uppercase; letter-spacing: 1px;">MATCH TIMELINE</h3>';
            
            if (matchData && matchData.events) {
                let allEvents = [];
                const goals = matchData.events.goals || [];
                const subs = matchData.events.substitutions || [];
                const cards = matchData.events.cards || [];
                
                goals.forEach(goal => {
                    const isTeamA = goal.team === 'home' || goal.teamLetter === 'A';
                    const teamName = isTeamA ? (matchData.teamA?.nazwa || 'Team A') : (matchData.teamB?.nazwa || 'Team B');
                    allEvents.push({
                        type: 'goal',
                        minute: parseInt(goal.minute) || 0,
                        player: goal.scorer || goal.player || 'Nieznany',
                        team: isTeamA ? 'A' : 'B',
                        teamName: teamName
                    });
                });
                
                subs.forEach(sub => {
                    const isTeamA = sub.team === 'home' || sub.teamLetter === 'A';
                    allEvents.push({
                        type: 'sub',
                        minute: parseInt(sub.minute) || 0,
                        playerOut: sub.playerOut || sub.player_out || '',
                        playerIn: sub.playerIn || sub.player_in || '',
                        team: isTeamA ? 'A' : 'B'
                    });
                });
                
                cards.forEach(card => {
                    const isTeamA = card.team === 'home' || card.teamLetter === 'A';
                    const cardType = (card.type === 'redcard' || card.cardType === 'red') ? 'red' : 'yellow';
                    allEvents.push({
                        type: cardType,
                        minute: parseInt(card.minute) || 0,
                        player: card.player || 'Nieznany',
                        team: isTeamA ? 'A' : 'B'
                    });
                });
                
                allEvents.sort((a, b) => a.minute - b.minute);
                
                if (allEvents.length > 0) {
                    html += '<div style="display: flex; flex-direction: column; gap: 0.5rem;">';
                    allEvents.forEach(e => {
                        const minute = e.minute + "'";
                        if (e.type === 'goal') {
                            html += `<div style="background: rgba(0, 170, 255, 0.1); border-left: 4px solid #00aaff; padding: 1rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">‚öΩ</span>
                                    <div>
                                        <div style="color: white; font-weight: bold;">${e.teamName}</div>
                                        <div style="color: #00aaff; font-size: 0.95rem;">${e.player}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-weight: bold; min-width: 50px; text-align: right;">${minute}</div>
                            </div>`;
                        } else if (e.type === 'yellow') {
                            html += `<div style="background: rgba(255, 200, 0, 0.1); border-left: 4px solid #ffc800; padding: 1rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">üü®</span>
                                    <div>
                                        <div style="color: #ffc800; font-weight: bold;">≈ª√≥≈Çta kartka</div>
                                        <div style="color: white; font-size: 0.95rem;">${e.player}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-weight: bold; min-width: 50px; text-align: right;">${minute}</div>
                            </div>`;
                        } else if (e.type === 'red') {
                            html += `<div style="background: rgba(220, 20, 60, 0.1); border-left: 4px solid #dc143c; padding: 1rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">üî¥</span>
                                    <div>
                                        <div style="color: #dc143c; font-weight: bold;">Czerwona kartka</div>
                                        <div style="color: white; font-size: 0.95rem;">${e.player}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-weight: bold; min-width: 50px; text-align: right;">${minute}</div>
                            </div>`;
                        } else if (e.type === 'sub') {
                            html += `<div style="background: rgba(100, 100, 100, 0.1); border-left: 4px solid #888; padding: 1rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <span style="font-size: 1.5rem;">üîÑ</span>
                                    <div>
                                        <div style="color: #888; font-weight: bold;">Zmiana</div>
                                        <div style="color: #bbb; font-size: 0.95rem;">‚¨áÔ∏è ${e.playerOut} ‚Üí ‚¨ÜÔ∏è ${e.playerIn}</div>
                                    </div>
                                </div>
                                <div style="color: #888; font-weight: bold; min-width: 50px; text-align: right;">${minute}</div>
                            </div>`;
                        }
                    });
                    html += '</div>';
                } else {
                    html += '<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem; padding: 3rem 2rem; color: #666;">';
                    html += '<div style="font-size: 3rem; opacity: 0.5;">üìä</div>';
                    html += '<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5rem;">NO EVENTS YET</div><div style="font-size: 0.9rem; color: #555;">Match events will appear here in real-time</div></div>';
                    html += '</div>';
                }
            } else {
                html += '<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem; padding: 3rem 2rem; color: #666;">';
                html += '<div style="font-size: 3rem; opacity: 0.5;">üìä</div>';
                html += '<div style="text-align: center;"><div style="font-weight: bold; margin-bottom: 0.5rem;">NO EVENTS YET</div><div style="font-size: 0.9rem; color: #555;">Match events will appear here in real-time</div></div>';
                html += '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        })
        .catch(err => {
            console.error('[FACTS] B≈ÇƒÖd pobierania danych:', err);
            let html = '<div style="text-align: center; color: #888; padding: 2rem;">Brak danych</div>';
            container.innerHTML = html;
        });
}

function displayLiveTab() {
    const container = document.getElementById('live-content');
    if (!container) return;
    
    let html = '<h3>üì∫ Na ≈ºywo</h3>';
    html += '<div style="color: #888; text-align: center; padding: 2rem;">Brana relacja na ≈ºywo niedostƒôpna</div>';
    
    container.innerHTML = html;
}

function displayLineupTab() {
    const container = document.getElementById('lineup-content');
    if (!container) return;
    
    let html = `<h3>üë• Sk≈Çady</h3>
        <div style="margin-bottom: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div style="text-align: center; flex: 1;">
                    <div id="home-formation" style="color: #00aaff; font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">4-2-3-1</div>
                    <div id="home-team-name" style="color: white; font-weight: 600;">Dru≈ºyna A</div>
                </div>
                <div style="color: #888; padding: 0 2rem;">VS</div>
                <div style="text-align: center; flex: 1;">
                    <div id="away-formation" style="color: #00aaff; font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">3-4-2-1</div>
                    <div id="away-team-name" style="color: white; font-weight: 600;">Dru≈ºyna B</div>
                </div>
            </div>
        </div>
        
        <svg width="100%" height="500" viewBox="0 0 1200 700" style="background: linear-gradient(to bottom, #1a5f2f, #2d8659); border: 2px solid #fff; border-radius: 8px; margin-bottom: 2rem;">
            <!-- Outer border -->
            <rect x="50" y="50" width="1100" height="600" fill="none" stroke="white" stroke-width="3"/>
            
            <!-- Center line -->
            <line x1="600" y1="50" x2="600" y2="650" stroke="white" stroke-width="2"/>
            
            <!-- Center circle -->
            <circle cx="600" cy="350" r="100" fill="none" stroke="white" stroke-width="2"/>
            <circle cx="600" cy="350" r="8" fill="white"/>
            
            <!-- Left penalty box -->
            <rect x="50" y="150" width="250" height="400" fill="none" stroke="white" stroke-width="2"/>
            
            <!-- Left goal box -->
            <rect x="50" y="250" width="100" height="200" fill="none" stroke="white" stroke-width="2"/>
            
            <!-- Left goal -->
            <line x1="50" y1="300" x2="30" y2="300" stroke="white" stroke-width="2"/>
            <line x1="30" y1="300" x2="30" y2="400" stroke="white" stroke-width="2"/>
            <line x1="30" y1="400" x2="50" y2="400" stroke="white" stroke-width="2"/>
            
            <!-- Left arc -->
            <path d="M 300 200 Q 320 350 300 500" fill="none" stroke="white" stroke-width="2"/>
            
            <!-- Right penalty box -->
            <rect x="900" y="150" width="250" height="400" fill="none" stroke="white" stroke-width="2"/>
            
            <!-- Right goal box -->
            <rect x="1050" y="250" width="100" height="200" fill="none" stroke="white" stroke-width="2"/>
            
            <!-- Right goal -->
            <line x1="1150" y1="300" x2="1170" y2="300" stroke="white" stroke-width="2"/>
            <line x1="1170" y1="300" x2="1170" y2="400" stroke="white" stroke-width="2"/>
            <line x1="1170" y1="400" x2="1150" y2="400" stroke="white" stroke-width="2"/>
            
            <!-- Right arc -->
            <path d="M 900 200 Q 880 350 900 500" fill="none" stroke="white" stroke-width="2"/>
        </svg>
        
        <div style="background: rgba(0, 170, 255, 0.1); border: 1px solid rgba(0, 170, 255, 0.2); padding: 1.5rem; border-radius: 8px; text-align: center;">
            <p style="color: #888; margin: 0;">Szczeg√≥≈Çy sk≈Çad√≥w bƒôdƒÖ dostƒôpne tutaj</p>
        </div>
    </div>`;
    
    container.innerHTML = html;
    
    if (currentMatchTeamA) {
        document.getElementById('home-team-name').textContent = currentMatchTeamA.nazwa;
    }
    if (currentMatchTeamB) {
        document.getElementById('away-team-name').textContent = currentMatchTeamB.nazwa;
    }
}

function displayStatsTab() {
    const container = document.getElementById('stats-content');
    if (!container) return;
    
    let html = `<div style="color: #ddd;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div style="text-align: center;">
                <div style="color: #888; margin-bottom: 0.5rem;">Posiadanie pi≈Çki</div>
                <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">50%</div>
            </div>
            <div style="text-align: center;">
                <div style="color: #888; margin-bottom: 0.5rem;">Posiadanie pi≈Çki</div>
                <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">50%</div>
            </div>
        </div>
    </div>`;
    
    container.innerHTML = html;
}

function renderLeagueTable() {
    const container = document.getElementById('league-table-content');
    if (!container) return;
    
    const selectedLeague = document.getElementById('match-detail-league-select')?.value || 'ekstraklasa';
    const tableData = selectedLeague === 'ekstraklasa' ? tablekaEkstraklasa : tabela1Liga;
    
    if (!tableData || tableData.length === 0) {
        container.innerHTML = '<div style="color: #888; text-align: center; padding: 2rem;">Brak danych tabeli</div>';
        return;
    }
    
    let html = `<table class="league-table">
        <thead>
            <tr>
                <th style="width: 40px;">#</th>
                <th>DRU≈ªYNA</th>
                <th style="text-align: center;">MECZE</th>
                <th style="text-align: center;">PUNKTY</th>
                <th style="text-align: center;">ZWYCIƒòSTWA</th>
                <th style="text-align: center;">REMISY</th>
                <th style="text-align: center;">PRZEGRANE</th>
                <th style="text-align: center;">BRAMKI</th>
                <th style="text-align: center;">FORMA</th>
            </tr>
        </thead>
        <tbody>`;
    
    tableData.forEach((team, index) => {
        const position = index + 1;
        const logo = getTeamLogo(team.name || team.nazwa);
        const wins = team.wins || 0;
        const draws = team.draws || 0;
        const losses = team.losses || 0;
        const matches = team.matches || (wins + draws + losses);
        const points = team.points || (wins * 3 + draws);
        const goalsFor = team.goalsFor || 0;
        const goalsAgainst = team.goalsAgainst || 0;
        const goalDiff = goalsFor - goalsAgainst;
        
        let form = team.form || '';
        let formHtml = '';
        if (form) {
            const formGames = form.split('').slice(0, 5);
            formGames.forEach(result => {
                let className = '';
                if (result === 'W') className = 'form-win';
                else if (result === 'D') className = 'form-draw';
                else if (result === 'L') className = 'form-loss';
                formHtml += `<div class="form-badge ${className}">${result}</div>`;
            });
        }
        
        const isLiveTeam = team.name === currentMatchTeamA?.nazwa || team.name === currentMatchTeamB?.nazwa;
        const liveIcon = isLiveTeam ? '<span class="table-live-badge">LIVE</span>' : '';
        
        let rowStyle = '';
        if (position === 1) {
            rowStyle = 'background: rgba(255, 215, 0, 0.1); border-left: 4px solid #ffd700;';
        } else if (position > tableData.length - 3) {
            rowStyle = 'background: rgba(220, 20, 60, 0.1); border-left: 4px solid #dc143c;';
        }
        
        let positionDisplay = position;
        if (position === 1) {
            positionDisplay = 'üèÜ ' + position;
        }
        
        html += `<tr style="${rowStyle}">
            <td class="table-position">${positionDisplay}</td>
            <td>
                <div class="table-team">
                    <img src="${logo}" class="table-team-logo" alt="">
                    <span class="table-team-name">${team.name || team.nazwa}</span>
                    ${liveIcon}
                </div>
            </td>
            <td class="table-stat">${matches}</td>
            <td class="table-stat" style="font-weight: bold; color: #00aaff;">${points}</td>
            <td class="table-stat">${wins}</td>
            <td class="table-stat">${draws}</td>
            <td class="table-stat">${losses}</td>
            <td class="table-stat">${goalsFor}:${goalsAgainst}</td>
            <td style="padding: 1rem;">
                <div class="table-form">
                    ${formHtml || '<span style="color: #888;">-</span>'}
                </div>
            </td>
        </tr>`;
    });
    
    html += `</tbody></table>`;
    
    const legendHtml = `
        <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(0, 0, 0, 0.5); border-radius: 8px; display: flex; gap: 2rem; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 0.8rem; color: #aaa;">
                <div style="width: 30px; height: 30px; background: rgba(255, 215, 0, 0.2); border-left: 3px solid #ffd700; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üèÜ</div>
                <span>Mistrz</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.8rem; color: #aaa;">
                <div style="width: 30px; height: 30px; background: rgba(220, 20, 60, 0.2); border-left: 3px solid #dc143c;"></div>
                <span>Strefa spadkowa</span>
            </div>
        </div>
    `;
    
    container.innerHTML = html + legendHtml;
}

function updateTableDisplay() {
    renderLeagueTable();
}

function filterLeagueTable(type, button) {
    const buttons = document.querySelectorAll('.table-filter-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    button.classList.add('active');
    renderLeagueTable();
}

function updateEventFeed() {
    const feedContent = document.getElementById('event-feed-content');
    if (!feedContent) return;
    
    let matchData = lastValidMatchData;
    if (allLiveMatches && allLiveMatches[selectedMatchIndex]) {
        matchData = allLiveMatches[selectedMatchIndex];
    }
    
    if (!matchData || !matchData.events) {
        return;
    }
    
    const events = matchData.events;
    const goals = events.goals || [];
    const subs = events.substitutions || [];
    
    let allEvents = [];
    const seenGoals = new Set();
    
    goals.forEach(goal => {
        const goalKey = `${goal.team}_${goal.minute}_${goal.scorer || goal.player}`;
        if (!seenGoals.has(goalKey)) {
            seenGoals.add(goalKey);
            const isTeamA = goal.team === 'home';
            const teamName = isTeamA ? matchData.teamA.nazwa : matchData.teamB.nazwa;
            const playerName = goal.scorer || goal.player || 'Nieznany gracz';
            
            allEvents.push({
                type: 'goal',
                minute: goal.minute,
                team: goal.team,
                teamName: teamName,
                player: playerName
            });
        }
    });
    
    subs.forEach(sub => {
        allEvents.push({
            type: 'substitution',
            minute: sub.minute,
            playerOut: sub.playerOut,
            playerIn: sub.playerIn
        });
    });
    
    allEvents.sort((a, b) => b.minute - a.minute);
    
    if (allEvents.length === 0) {
        feedContent.innerHTML = '<div style="text-align: center; color: #666; font-size: 0.85rem;">Brak zdarze≈Ñ</div>';
        return;
    }
    
    let html = '';
    allEvents.slice(0, 10).forEach(event => {
        if (event.type === 'goal') {
            const roundedTime = roundTimeToMinute(event.minute);
            html += `
                <div class="event-item">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 0.5rem;">
                        <span class="event-item-text">‚öΩ ${event.teamName}</span>
                        <span class="event-item-time">${roundedTime}'</span>
                    </div>
                    <div style="color: #00aaff; font-size: 0.8rem; margin-top: 0.3rem;">${event.player}</div>
                </div>
            `;
        } else if (event.type === 'substitution') {
            const roundedTime = roundTimeToMinute(event.minute);
            html += `
                <div class="event-item" style="border-left-color: #ffaa00;">
                    <div style="color: #ddd; font-size: 0.85rem;">‚¨áÔ∏è #${event.playerOut}</div>
                    <div style="color: #ddd; font-size: 0.85rem; margin: 0.3rem 0;">‚Üí</div>
                    <div style="color: #00aaff; font-size: 0.85rem;">‚¨ÜÔ∏è #${event.playerIn}</div>
                    <div class="event-item-time" style="margin-top: 0.3rem;">${roundedTime}'</div>
                </div>
            `;
        }
    });
    
    feedContent.innerHTML = html;
}

function showView(viewName) {
    const newsView = document.getElementById('news-view');
    const tableView = document.getElementById('table-view');
    const scheduleView = document.getElementById('schedule-view');
    const cupBracketView = document.getElementById('cup-bracket-view');
    const scoreboardView = document.getElementById('scoreboard-view');
    const matchDetailView = document.getElementById('match-detail-view');
    const articleView = document.getElementById('article-view');
    const clubsView = document.getElementById('clubs-view');
    const clubProfileView = document.getElementById('club-profile-view');
    
    const navNews = document.getElementById('nav-news');
    const navTable = document.getElementById('nav-table');
    const navSchedule = document.getElementById('nav-schedule');
    const navClubs = document.getElementById('nav-clubs');
    const navCup = document.getElementById('nav-cup');

    newsView.style.display = 'none';
    tableView.style.display = 'none';
    scheduleView.style.display = 'none';
    cupBracketView.style.display = 'none';
    if (scoreboardView) scoreboardView.style.display = 'none';
    if (matchDetailView) matchDetailView.style.display = 'none';
    if (articleView) articleView.style.display = 'none';
    if (clubsView) clubsView.style.display = 'none';
    if (clubProfileView) clubProfileView.style.display = 'none';
    
    navNews.classList.remove('active');
    navTable.classList.remove('active');
    navSchedule.classList.remove('active');
    if (navClubs) navClubs.classList.remove('active');
    if (navCup) navCup.classList.remove('active');

    if (viewName === 'news') {
        newsView.style.display = 'grid';
        navNews.classList.add('active');
    } else if (viewName === 'table') {
        tableView.style.display = 'block';
        navTable.classList.add('active');
        renderFullTable();
    } else if (viewName === 'schedule') {
        scheduleView.style.display = 'block';
        navSchedule.classList.add('active');
        renderSchedule();
        if (!pollInterval) {
            pollInterval = setInterval(pollMatchStatus, 2000);
            pollMatchStatus();
        }
    } else if (viewName === 'cup-bracket') {
        cupBracketView.style.display = 'block';
        if (navCup) navCup.classList.add('active');
        renderCupBracket();
    } else if (viewName === 'scoreboard') {
        if (scoreboardView) scoreboardView.style.display = 'block';
        loadScheduleMatches();
    } else if (viewName === 'match-detail') {
        if (matchDetailView) matchDetailView.style.display = 'block';
    } else if (viewName === 'article') {
        if (articleView) articleView.style.display = 'block';
    } else if (viewName === 'clubs') {
        if (clubsView) clubsView.style.display = 'block';
        if (navClubs) navClubs.classList.add('active');
        showClubsView();
    } else if (viewName === 'club-profile') {
        if (clubProfileView) clubProfileView.style.display = 'block';
    }
}

function loadMainCountdown() {
    const container = document.getElementById('main-countdown-banner');
    if (!container) return;

    const nextMatchDate = new Date('2026-01-30T20:30:00'); 
    
    const homeTeam = druzyny[7]; 
    const awayTeam = druzyny[0]; 

    const dateObj = new Date(nextMatchDate);
    const dayNames = ['NIEDZIELA', 'PONIEDZIA≈ÅEK', 'WTOREK', '≈öRODA', 'CZWARTEK', 'PIƒÑTEK', 'SOBOTA'];
    const dayName = dayNames[dateObj.getDay()];
    const dateStr = `${dayName}, ${String(dateObj.getDate()).padStart(2, '0')}.${String(dateObj.getMonth() + 1).padStart(2, '0')}.${dateObj.getFullYear()}`;

    container.innerHTML = `
        <div style="display: flex; align-items: stretch; height: 150px; border-radius: 4px; overflow: hidden;">
            <div style="background: url('https://i.ibb.co/B5JxR704/obraz-2025-12-21-221127165.png') center/cover; flex: 0 0 40%; display: flex; flex-direction: column; justify-content: center; padding: 2rem; color: white;">
                <div style="font-size: 0.85rem; text-transform: uppercase; color: #aaa; margin-bottom: 0.5rem;">AZTOR–ò–ù</div>
                <div style="font-size: 1.1rem; font-weight: bold; text-transform: uppercase; margin-bottom: 1rem;">Odlicza czas do nastƒôpnego meczu</div>
            </div>
            <div style="background: #1a1a1a; flex: 1; display: flex; align-items: center; justify-content: space-between; padding: 0 2rem; position: relative;">
                <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <img src="${homeTeam.logo}" alt="${homeTeam.nazwa}" style="height: 60px; width: auto;">
                    <div style="color: white; font-weight: bold; font-size: 0.9rem;">${homeTeam.skrot}</div>
                </div>
                
                <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                    <div style="color: white; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; color: #888;">${dateStr}</div>
                    <div style="color: #00aaff; font-weight: bold; font-size: 2.5rem; font-family: 'Courier New', monospace; letter-spacing: 2px;" id="main-timer">00:00:00:00</div>
                    <div style="display: flex; gap: 1rem; font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px;">
                        <span>DNI</span>
                        <span>GODZ</span>
                        <span>MIN</span>
                        <span>SEK</span>
                    </div>
                </div>
                
                <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                    <img src="${awayTeam.logo}" alt="${awayTeam.nazwa}" style="height: 60px; width: auto;">
                    <div style="color: white; font-weight: bold; font-size: 0.9rem;">${awayTeam.skrot}</div>
                </div>
            </div>
        </div>
    `;

    startMainTimer(nextMatchDate);
}

function startMainTimer(targetDate) {
    function update() {
        const now = new Date().getTime();
        const distance = targetDate.getTime() - now;

        if (distance < 0) {
            const timerElement = document.getElementById("main-timer");
            if (timerElement) timerElement.innerHTML = "MECZ TRWA";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        const timerElement = document.getElementById("main-timer");
        if (timerElement) {
            timerElement.innerHTML = 
                (days < 10 ? "0" + days : days) + " : " + 
                (hours < 10 ? "0" + hours : hours) + " : " + 
                (minutes < 10 ? "0" + minutes : minutes) + " : " + 
                (seconds < 10 ? "0" + seconds : seconds);
        }
    }

    setInterval(update, 1000);
    update();
}

function renderSchedule() {
    const container = document.getElementById('schedule-content');
    const titleElement = document.getElementById('round-title');
    if (!container) return;

    const round = terminarz.find(r => r.kolejka === currentRound);
    if (!round) {
        container.innerHTML = '<div style="color: #888; text-align: center; padding: 2rem;">Brak mecz√≥w w tej kolejce</div>';
        return;
    }
    
    if (titleElement) {
        titleElement.textContent = `${round.kolejka}. KOLEJKA`;
    }
    
    let html = '';
    
    round.mecze.forEach(match => {
        const logoA = getTeamLogo(match.teamA);
        const logoB = getTeamLogo(match.teamB);
        const skrotA = getTeamShortcut(match.teamA);
        const skrotB = getTeamShortcut(match.teamB);
        
        const matchKey = `match_${match.id}_${match.teamA}_${match.teamB}`;
        const savedMatch = localStorage.getItem(matchKey);
        const matchData = savedMatch ? JSON.parse(savedMatch) : null;
        
        if (matchData && (matchData.status === 'KONIEC' || matchData.finished)) {
            let scorersA = '';
            let scorersB = '';
            
            if (matchData.events && matchData.events.goals) {
                const goals = Array.isArray(matchData.events.goals) ? 
                    matchData.events.goals.filter(g => g.type === 'goal' || !g.type) : 
                    matchData.events.goals;
                
                goals.forEach(goal => {
                    const isTeamA = goal.team === 'home';
                    const player = goal.scorer || goal.player || 'Nieznany';
                    const minute = goal.minute || '0';
                    const html = `<div style="color: #888; font-size: 0.8rem;">${player} ${minute}'</div>`;
                    
                    if (isTeamA) {
                        scorersA += html;
                    } else {
                        scorersB += html;
                    }
                });
            }
            
            html += `
                <div style="background: #1a1a1a; border: 1px solid #333; padding: 1rem; border-radius: 4px; margin-bottom: 0.8rem;">
                    <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: 1rem;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.8rem; margin-bottom: 0.5rem;">
                                <img src="${logoA}" alt="${match.teamA}" style="width: 35px; height: 35px; object-fit: contain;">
                                <div style="color: white; font-size: 0.9rem; font-weight: 500;">${skrotA}</div>
                            </div>
                            ${scorersA ? `<div style="padding-left: 0.5rem;">${scorersA}</div>` : ''}
                        </div>
                        <div style="text-align: center; min-width: 70px;">
                            <div style="color: #00aaff; font-size: 1.2rem; font-weight: bold;">${matchData.teamA?.score || 0}</div>
                            <div style="color: #00aaff; font-size: 1.2rem; font-weight: bold;">-</div>
                            <div style="color: #00aaff; font-size: 1.2rem; font-weight: bold;">${matchData.teamB?.score || 0}</div>
                            <div style="color: #888; font-size: 0.7rem; margin-top: 0.3rem;">KONIEC</div>
                        </div>
                        <div style="flex: 1; text-align: right;">
                            <div style="display: flex; align-items: center; gap: 0.8rem; margin-bottom: 0.5rem; justify-content: flex-end;">
                                <div style="color: white; font-size: 0.9rem; font-weight: 500;">${skrotB}</div>
                                <img src="${logoB}" alt="${match.teamB}" style="width: 35px; height: 35px; object-fit: contain;">
                            </div>
                            ${scorersB ? `<div style="padding-right: 0.5rem; text-align: right;">${scorersB}</div>` : ''}
                        </div>
                    </div>
                </div>
            `;
        } else {
            html += `
                <div style="background: #1a1a1a; border: 1px solid #333; padding: 1rem; border-radius: 4px; margin-bottom: 0.8rem; display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 0.8rem; flex: 1;">
                        <img src="${logoA}" alt="${match.teamA}" style="width: 40px; height: 40px; object-fit: contain;">
                        <div style="color: white; font-size: 0.9rem; font-weight: 500;">${skrotA}</div>
                    </div>
                    <div style="text-align: center; color: #888; font-size: 0.85rem;">${match.czas}</div>
                    <div style="display: flex; align-items: center; gap: 0.8rem; flex: 1; justify-content: flex-end;">
                        <div style="color: white; font-size: 0.9rem; font-weight: 500;">${skrotB}</div>
                        <img src="${logoB}" alt="${match.teamB}" style="width: 40px; height: 40px; object-fit: contain;">
                    </div>
                </div>
            `;
        }
    });

    container.innerHTML = html;
}

function changeRound(direction) {
    if (currentScheduleMode === 'rr') {
        const maxRounds = rrScheduleData ? rrScheduleData.length : 0;
        
        if (direction === -1 && rrCurrentRound > 1) {
            rrCurrentRound--;
            loadRoundRobinSchedule();
        } else if (direction === 1 && rrCurrentRound < maxRounds) {
            rrCurrentRound++;
            loadRoundRobinSchedule();
        }
    } else {
        const availableRounds = terminarz.map(r => r.kolejka).sort((a, b) => a - b);
        const currentIndex = availableRounds.indexOf(currentRound);
        
        if (direction === -1 && currentIndex > 0) {
            currentRound = availableRounds[currentIndex - 1];
            renderSchedule();
        } else if (direction === 1 && currentIndex < availableRounds.length - 1) {
            currentRound = availableRounds[currentIndex + 1];
            renderSchedule();
        }
    }
}

function loadClubsGallery() {
    const container = document.getElementById('clubs-grid');
    if (!container) return;
    
    container.innerHTML = '';
    druzyny.forEach(team => {
        const clubCard = document.createElement('div');
        clubCard.className = 'club-card-large';
        clubCard.style.backgroundImage = `url('${team.stadium}')`;
        clubCard.innerHTML = `
            <div class="club-card-overlay">
                <div class="club-card-logo">
                    <img src="${team.logo}" alt="${team.nazwa}">
                </div>
                <h3>${team.nazwa}</h3>
                <button class="club-profile-btn" onclick="showClubProfile(${team.id})">PROFIL KLUBU ‚Üí</button>
            </div>
        `;
        container.appendChild(clubCard);
    });
}

function getNextMatchForTeam(teamName) {
    for (const round of terminarz) {
        for (const match of round.mecze) {
            if (match.teamA === teamName || match.teamB === teamName) {
                return { match, round: round.kolejka };
            }
        }
    }
    return null;
}

function showClubProfile(teamId) {
    const team = druzyny.find(d => d.id === teamId);
    const stats = tabela.find(t => t.id === teamId);
    
    if (!team || !stats) return;
    
    const container = document.getElementById('club-profile-content');
    if (!container) return;
    
    const allViews = document.querySelectorAll('[id$="-view"]');
    allViews.forEach(view => view.style.display = 'none');
    
    const profileView = document.getElementById('club-profile-view');
    if (profileView) profileView.style.display = 'block';
    
    container.innerHTML = `
        <div style="max-width: 1400px; margin: 0 auto; padding: 2rem;" data-club-id="${teamId}">
            <button onclick="showClubsView()" style="background: rgba(51, 51, 51, 0.8); border: 1px solid #555; color: white; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; margin-bottom: 2rem; display: inline-block;">‚Üê POWR√ìT</button>
            
            <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem;">
                    <img src="${team.logo}" alt="${team.nazwa}" style="height: 100px; width: auto;">
                    <div>
                        <h1 style="color: white; font-size: 2rem; text-transform: uppercase; margin: 0; margin-bottom: 0.5rem;">${team.nazwa}</h1>
                        <div style="color: #888; font-size: 0.9rem;">Polska</div>
                    </div>
                    <div style="margin-left: auto; display: flex; gap: 1rem;">
                        <button style="background: rgba(0, 170, 255, 0.2); border: 1px solid #00aaff; color: white; padding: 0.6rem 1.2rem; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.85rem;">Synchronizuj z kalendarzem ‚§¥</button>
                        <button style="background: none; border: 1px solid #555; color: white; padding: 0.6rem 1.2rem; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.85rem;">Obserwuj</button>
                    </div>
                </div>
                
                <div style="display: flex; gap: 2rem; border-bottom: 1px solid rgba(0, 170, 255, 0.2); padding-bottom: 1.5rem; overflow-x: auto;">
                    <button onclick="switchClubsViewTab('przeglad', ${teamId})" class="club-gallery-tab-btn active" style="background: none; border: none; color: white; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: 3px solid #00aa00; white-space: nowrap;">PrzeglƒÖd</button>
                    <button onclick="switchClubsViewTab('tabela', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Tabela</button>
                    <button onclick="switchClubsViewTab('mecze', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Mecze</button>
                    <button onclick="switchClubsViewTab('sklad', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Sk≈Çad</button>
                    <button onclick="switchClubsViewTab('statystyki', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Statystyki</button>
                    <button onclick="switchClubsViewTab('transfery', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Transfery</button>
                    <button onclick="switchClubsViewTab('historia', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Historia</button>
                    <button onclick="switchClubsViewTab('newsy', ${teamId})" class="club-gallery-tab-btn" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 0.95rem; padding: 0; border-bottom: none; white-space: nowrap;">Newsy</button>
                </div>
            </div>
            
            <div id="club-gallery-tab-content" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem;">
                <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                    <div style="color: white; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">üìä Forma zespo≈Çu</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">0-0</div>
                        <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">0-2</div>
                        <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">2-2</div>
                        <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">1-1</div>
                        <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">1-2</div>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <img src="${team.logo}" alt="" style="height: 30px; width: 30px; object-fit: contain; border-radius: 4px;">
                    </div>
                </div>
                
                <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                    <div style="color: white; font-weight: bold; margin-bottom: 1rem;">Nastƒôpny mecz</div>
                    <div style="background: rgba(0, 50, 100, 0.3); padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="color: #888; font-size: 0.8rem; margin-bottom: 0.5rem;"><img src="https://i.ibb.co/7tYN4164/obraz-2025-12-21-221841692.png" alt="Liga" style="height: 20px; width: auto; vertical-align: middle;"></div>
                        ${(() => {
                            const nextMatch = getNextMatchForTeam(team.nazwa);
                            if (nextMatch) {
                                const opponent = nextMatch.match.teamA === team.nazwa ? nextMatch.match.teamB : nextMatch.match.teamA;
                                const opponentTeam = druzyny.find(d => d.nazwa === opponent);
                                const opponentLogo = opponentTeam ? opponentTeam.logo : '';
                                const matchDate = new Date('2026-01-30');
                                const dateStr = matchDate.toLocaleDateString('pl-PL', { day: '2-digit', month: 'short', year: 'numeric' });
                                return `
                                    <div style="display: flex; align-items: center; justify-content: space-around; margin: 1rem 0;">
                                        <img src="${team.logo}" alt="" style="height: 40px; width: auto;">
                                        <div style="color: white; font-weight: bold; font-size: 1.2rem;">vs</div>
                                        <img src="${opponentLogo}" alt="" style="height: 40px; width: auto;">
                                    </div>
                                    <div style="color: white; font-size: 0.9rem; margin-bottom: 0.5rem;">${team.nazwa} vs ${opponent}</div>
                                    <div style="color: #888; font-size: 0.8rem;">${nextMatch.match.czas} | ${dateStr}</div>
                                `;
                            } else {
                                return '<div style="color: #888;">Brak mecz√≥w</div>';
                            }
                        })()}
                    </div>
                </div>
                
                <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                    <div style="color: white; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">üë• Statystyki sezonu</div>
                    <div style="font-size: 0.9rem; color: #888;">Pozostania rozpoczƒôta 11-tka</div>
                </div>
            </div>
        </div>
    `;
}

function switchClubsViewTab(tab, teamId) {
    const buttons = document.querySelectorAll('.club-gallery-tab-btn');
    buttons.forEach(btn => {
        btn.style.color = '#888';
        btn.style.borderBottom = 'none';
    });
    
    if (event && event.target) {
        event.target.style.color = 'white';
        event.target.style.borderBottom = '3px solid #00aa00';
    }
    
    const contentDiv = document.getElementById('club-gallery-tab-content');
    const team = druzyny.find(d => d.id === teamId);
    const stats = tabela.find(t => t.id === teamId);
    
    if (tab === 'przeglad') {
        const isTeamPlaying = lastValidMatchData && lastValidMatchData.active && (lastValidMatchData.teamA.nazwa === team.nazwa || lastValidMatchData.teamB.nazwa === team.nazwa);
        
        let liveSection = '';
        if (isTeamPlaying) {
            const isTeamA = lastValidMatchData.teamA.nazwa === team.nazwa;
            const opponent = isTeamA ? lastValidMatchData.teamB : lastValidMatchData.teamA;
            const teamLogo = isTeamA ? lastValidMatchData.teamA.logo : lastValidMatchData.teamB.logo;
            const opponentLogo = isTeamA ? lastValidMatchData.teamB.logo : lastValidMatchData.teamA.logo;
            
            liveSection = `
                <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2); grid-column: 1 / -1; border-left: 4px solid #ff0000; margin-bottom: 1rem;">
                    <div style="color: white; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="width: 12px; height: 12px; background: #ff0000; border-radius: 50%; display: inline-block;"></span> AKTUALNIE NA ≈ªYWO
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-around; gap: 1.5rem;">
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <img src="${teamLogo}" alt="" style="height: 40px; width: auto; margin-bottom: 0.5rem;">
                            <div style="color: white; font-weight: bold; font-size: 0.9rem;">${team.nazwa}</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div style="color: #00aaff; font-weight: bold; font-size: 2rem;">${lastValidMatchData.teamA.score || 0}</div>
                            <div style="color: #888; font-size: 0.75rem;">MIN ${lastValidMatchData.timer || '0'}'</div>
                            <div style="color: #00aaff; font-weight: bold; font-size: 2rem;">${lastValidMatchData.teamB.score || 0}</div>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <img src="${opponentLogo}" alt="" style="height: 40px; width: auto; margin-bottom: 0.5rem;">
                            <div style="color: white; font-weight: bold; font-size: 0.9rem;">${opponent.nazwa}</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        contentDiv.innerHTML = liveSection + `
            <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                <div style="color: white; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">üìä Forma zespo≈Çu</div>
                <div style="display: flex; gap: 0.5rem;">
                    <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">0-0</div>
                    <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">0-2</div>
                    <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">2-2</div>
                    <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">1-1</div>
                    <div style="background: rgba(100, 150, 100, 0.4); padding: 0.4rem 0.8rem; border-radius: 4px; color: white; font-size: 0.85rem; font-weight: bold;">1-2</div>
                </div>
            </div>
            
            <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                <div style="color: white; font-weight: bold; margin-bottom: 1rem;">Nastƒôpny mecz</div>
                <div style="background: rgba(0, 50, 100, 0.3); padding: 1rem; border-radius: 8px; text-align: center;">
                    <div style="color: #888; font-size: 0.8rem; margin-bottom: 0.5rem;"><img src="https://i.ibb.co/7tYN4164/obraz-2025-12-21-221841692.png" alt="Liga" style="height: 20px; width: auto; vertical-align: middle;"></div>
                    ${(() => {
                        const nextMatch = getNextMatchForTeam(team.nazwa);
                        if (nextMatch) {
                            const opponent = nextMatch.match.teamA === team.nazwa ? nextMatch.match.teamB : nextMatch.match.teamA;
                            const opponentTeam = druzyny.find(d => d.nazwa === opponent);
                            const opponentLogo = opponentTeam ? opponentTeam.logo : '';
                            const matchDate = new Date('2026-01-30');
                            const dateStr = matchDate.toLocaleDateString('pl-PL', { day: '2-digit', month: 'short', year: 'numeric' });
                            return `
                                <div style="display: flex; align-items: center; justify-content: space-around; margin: 1rem 0;">
                                    <img src="${team.logo}" alt="" style="height: 40px; width: auto;">
                                    <div style="color: white; font-weight: bold; font-size: 1.2rem;">vs</div>
                                    <img src="${opponentLogo}" alt="" style="height: 40px; width: auto;">
                                </div>
                                <div style="color: white; font-size: 0.9rem; margin-bottom: 0.5rem;">${nextMatch.match.czas} | ${dateStr}</div>
                            `;
                        } else {
                            return '<div style="color: #888;">Brak mecz√≥w</div>';
                        }
                    })()}
                </div>
            </div>
            
            <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2);">
                <div style="color: white; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">üë• Statystyki sezonu</div>
                <div style="font-size: 0.9rem; color: #888;">Pozostania rozpoczƒôta 11-tka</div>
            </div>
        `;
    } else if (tab === 'tabela') {
        let tableHTML = `
            <div style="background: rgba(30, 30, 30, 0.9); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(0, 170, 255, 0.2); grid-column: 1 / -1;">
                <div style="color: white; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">‚öΩ Ekstraklasa</div>
                <table style="width: 100%; border-collapse: collapse; color: white; font-size: 0.9rem;">
                    <thead>
                        <tr style="border-bottom: 1px solid rgba(0, 170, 255, 0.2);">
                            <th style="padding: 0.8rem; text-align: left; color: #888;">#</th>
                            <th style="padding: 0.8rem; text-align: left; color: #888;">Zesp√≥≈Ç</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">M</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">Z</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">R</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">P</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">+/-</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">=</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888;">PKT.</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        tabela.slice(0, 10).forEach((team, index) => {
            const isCurrentTeam = team.id === teamId;
            tableHTML += `
                <tr style="border-bottom: 1px solid rgba(0, 170, 255, 0.1); background: ${isCurrentTeam ? 'rgba(0, 170, 255, 0.1)' : 'transparent'};">
                    <td style="padding: 0.8rem; color: ${index === 0 ? '#00aa00' : '#888'}; font-weight: bold; border-left: 3px solid ${isCurrentTeam ? '#00aaff' : 'transparent'};">${index + 1}</td>
                    <td style="padding: 0.8rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <img src="${druzyny.find(d => d.id === team.id)?.logo || ''}" alt="" style="height: 20px; width: auto;">
                            <span>${druzyny.find(d => d.id === team.id)?.nazwa || ''}</span>
                        </div>
                    </td>
                    <td style="padding: 0.8rem; text-align: center;">${team.mecze}</td>
                    <td style="padding: 0.8rem; text-align: center;">${team.wygrane}</td>
                    <td style="padding: 0.8rem; text-align: center;">${team.remisy}</td>
                    <td style="padding: 0.8rem; text-align: center;">${team.przegrane}</td>
                    <td style="padding: 0.8rem; text-align: center; color: ${team.bramkiZa > team.bramkiProti ? '#00aa00' : '#ff0000'};">+${team.bramkiZa - team.bramkiProti}</td>
                    <td style="padding: 0.8rem; text-align: center;">${team.bramkiZa}:${team.bramkiProti}</td>
                    <td style="padding: 0.8rem; text-align: center; color: #00aaff; font-weight: bold;">${team.punkty}</td>
                </tr>
            `;
        });
        
        tableHTML += '</tbody></table></div>';
        contentDiv.innerHTML = tableHTML;
    } else if (tab === 'mecze') {
        let matchesHTML = `<div style="grid-column: 1 / -1; background: rgba(30, 30, 30, 0.9); border-radius: 12px; border: 1px solid rgba(0, 170, 255, 0.2); padding: 1.5rem;">`;
        
        const teamMatches = [];
        terminarz.forEach(round => {
            round.mecze.forEach(match => {
                if (match.teamA === team.nazwa || match.teamB === team.nazwa) {
                    teamMatches.push({ match, round: round.kolejka });
                }
            });
        });
        
        if (teamMatches.length === 0) {
            matchesHTML += '<div style="color: #888; text-align: center; padding: 2rem;">Brak mecz√≥w</div>';
        } else {
            matchesHTML += '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            teamMatches.forEach(({ match, round }) => {
                const logoA = druzyny.find(t => t.nazwa === match.teamA)?.logo || '';
                const logoB = druzyny.find(t => t.nazwa === match.teamB)?.logo || '';
                const skrotA = druzyny.find(t => t.nazwa === match.teamA)?.skrot || match.teamA;
                const skrotB = druzyny.find(t => t.nazwa === match.teamB)?.skrot || match.teamB;
                
                matchesHTML += `
                    <div style="background: rgba(0, 50, 100, 0.2); border: 1px solid rgba(0, 170, 255, 0.1); padding: 1rem; border-radius: 8px;">
                        <div style="color: #888; font-size: 0.8rem; margin-bottom: 0.5rem; text-transform: uppercase;">${round}. KOLEJKA</div>
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; flex: 1;">
                                <img src="${logoA}" alt="" style="height: 24px; width: auto;">
                                <span style="color: white; font-weight: bold;">${skrotA}</span>
                            </div>
                            <div style="text-align: center; color: #00aaff; font-weight: bold; min-width: 60px;">${match.czas}</div>
                            <div style="display: flex; align-items: center; gap: 0.5rem; flex: 1; justify-content: flex-end;">
                                <span style="color: white; font-weight: bold;">${skrotB}</span>
                                <img src="${logoB}" alt="" style="height: 24px; width: auto;">
                            </div>
                        </div>
                    </div>
                `;
            });
            matchesHTML += '</div>';
        }
        
        matchesHTML += '</div>';
        contentDiv.innerHTML = matchesHTML;
    } else if (tab === 'sklad') {
        const teamPlayers = zawodnicy.filter(z => z.klub === teamId);
        let playerHTML = `
            <div style="grid-column: 1 / -1; background: rgba(30, 30, 30, 0.9); border-radius: 12px; border: 1px solid rgba(0, 170, 255, 0.2); padding: 1.5rem;">
                <table style="width: 100%; border-collapse: collapse; color: white;">
                    <thead>
                        <tr style="border-bottom: 1px solid rgba(0, 170, 255, 0.2);">
                            <th style="padding: 0.8rem; text-align: left; color: #888; font-weight: normal; font-size: 0.85rem;">GRACZ</th>
                            <th style="padding: 0.8rem; text-align: left; color: #888; font-weight: normal; font-size: 0.85rem;">POZYCJA</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888; font-weight: normal; font-size: 0.85rem;">GOLE</th>
                            <th style="padding: 0.8rem; text-align: center; color: #888; font-weight: normal; font-size: 0.85rem;">ASYSTY</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        teamPlayers.forEach(player => {
            playerHTML += `
                <tr style="border-bottom: 1px solid rgba(0, 170, 255, 0.1);">
                    <td style="padding: 0.8rem; color: white; font-weight: 600;">${player.imie} ${player.nazwisko}</td>
                    <td style="padding: 0.8rem; color: #aaa;">${player.pozycja}</td>
                    <td style="padding: 0.8rem; text-align: center; color: #00aaff; font-weight: bold;">${player.gole || 0}</td>
                    <td style="padding: 0.8rem; text-align: center; color: #00aaff; font-weight: bold;">${player.asysty || 0}</td>
                </tr>
            `;
        });
        playerHTML += '</tbody></table></div>';
        contentDiv.innerHTML = playerHTML;
    } else if (tab === 'statystyki') {
        contentDiv.innerHTML = '<div style="grid-column: 1 / -1; color: white; padding: 2rem; background: rgba(30, 30, 30, 0.9); border-radius: 12px; border: 1px solid rgba(0, 170, 255, 0.2); text-align: center;">Statystyki szczeg√≥≈Çowe</div>';
    } else if (tab === 'transfery') {
        contentDiv.innerHTML = '<div style="grid-column: 1 / -1; color: white; padding: 2rem; background: rgba(30, 30, 30, 0.9); border-radius: 12px; border: 1px solid rgba(0, 170, 255, 0.2); text-align: center;">Historia transfer√≥w</div>';
    } else if (tab === 'historia') {
        contentDiv.innerHTML = '<div style="grid-column: 1 / -1; color: white; padding: 2rem; background: rgba(30, 30, 30, 0.9); border-radius: 12px; border: 1px solid rgba(0, 170, 255, 0.2); text-align: center;">Historia zespo≈Çu</div>';
    } else if (tab === 'newsy') {
        contentDiv.innerHTML = '<div style="grid-column: 1 / -1; color: white; padding: 2rem; background: rgba(30, 30, 30, 0.9); border-radius: 12px; border: 1px solid rgba(0, 170, 255, 0.2); text-align: center;">Newsy o zespole</div>';
    }
}

function switchClubProfile(tab, teamId) {
    const buttons = document.querySelectorAll('.club-profile-tab-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    event.target.style.color = 'white';
    event.target.style.borderBottomColor = '#00aaff';
    
    const otherBtn = Array.from(buttons).find(b => b !== event.target);
    if (otherBtn) {
        otherBtn.style.color = '#888';
        otherBtn.style.borderBottomColor = 'transparent';
    }
    
    const team = druzyny.find(d => d.id === teamId);
    const stats = tabela.find(t => t.id === teamId);
    const contentDiv = document.getElementById('club-profile-tab-content');
    
    if (tab === 'o-klubie') {
        contentDiv.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                    <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">MECZE</div>
                    <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">${stats.mecze}</div>
                </div>
                <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                    <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">PUNKTY</div>
                    <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">${stats.punkty}</div>
                </div>
                <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                    <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">ZWYCIƒòSTWA</div>
                    <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">${stats.wygrane}</div>
                </div>
                <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                    <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">REMISY</div>
                    <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">${stats.remisy}</div>
                </div>
                <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                    <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">PORA≈ªKI</div>
                    <div style="color: #00aaff; font-size: 2rem; font-weight: bold;">${stats.przegrane}</div>
                </div>
                <div style="background: rgba(0, 50, 100, 0.5); border-left: 3px solid #00aaff; padding: 1.5rem; border-radius: 4px;">
                    <div style="color: #888; font-size: 0.85rem; text-transform: uppercase; margin-bottom: 0.5rem;">BRAMKI</div>
                    <div style="color: #00aaff; font-size: 2rem; font-weight: bold; display: flex; gap: 0.5rem;"><span>${stats.bramkiZa}</span><span style="color: #666;">:</span><span>${stats.bramkiProti}</span></div>
                </div>
            </div>
        `;
    } else if (tab === 'zawodnicy') {
        const teamPlayers = zawodnicy.filter(z => z.klub === teamId);
        const strikers = teamPlayers.filter(z => z.pozycja === 'Napastnik').sort((a, b) => b.gole - a.gole);
        const assists = teamPlayers.sort((a, b) => b.asysty - a.asysty);
        
        contentDiv.innerHTML = `
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                <button class="player-tab active" onclick="switchPlayerTab('strzelcy', this)" style="background: none; border: none; color: white; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid #00aaff;">STRZELCY</button>
                <button class="player-tab" onclick="switchPlayerTab('asysty', this)" style="background: none; border: none; color: #888; cursor: pointer; font-weight: bold; font-size: 1rem; padding-bottom: 0.5rem; border-bottom: 3px solid transparent;">ASYSTY</button>
            </div>
            <div id="strikers-content" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                ${strikers.map((p, i) => `
                    <div style="background: rgba(0, 50, 100, 0.5); padding: 1.5rem; border-radius: 4px; border: 1px solid rgba(0, 170, 255, 0.2); text-align: center;">
                        <div style="color: #00aaff; font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${i + 1}</div>
                        <div style="color: white; font-weight: bold; margin-bottom: 1rem;">${p.imie} ${p.nazwisko}</div>
                        <div style="color: #00aaff; font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${p.gole}</div>
                        <div style="color: #888; font-size: 0.9rem; margin-bottom: 1rem;">GOLI</div>
                        <a href="${p.profil}" target="_blank" style="color: #00aaff; text-decoration: none; font-weight: bold;">PROFIL ‚Üí</a>
                    </div>
                `).join('')}
            </div>
            <div id="assists-content" style="display: none; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                ${assists.map((p, i) => `
                    <div style="background: rgba(0, 50, 100, 0.5); padding: 1.5rem; border-radius: 4px; border: 1px solid rgba(0, 170, 255, 0.2); text-align: center;">
                        <div style="color: #00aaff; font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${i + 1}</div>
                        <div style="color: white; font-weight: bold; margin-bottom: 1rem;">${p.imie} ${p.nazwisko}</div>
                        <div style="color: #00aaff; font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">${p.asysty}</div>
                        <div style="color: #888; font-size: 0.9rem; margin-bottom: 1rem;">ASYST</div>
                        <a href="${p.profil}" target="_blank" style="color: #00aaff; text-decoration: none; font-weight: bold;">PROFIL ‚Üí</a>
                    </div>
                `).join('')}
            </div>
        `;
    }
}

function switchClubTab(tab) {
    const aboutDiv = document.getElementById('club-tab-about');
    const tableDiv = document.getElementById('club-tab-table');
    const meczDiv = document.getElementById('club-tab-mecze');
    const statsDiv = document.getElementById('club-tab-stats');
    const seasonsDiv = document.getElementById('club-tab-seasons');
    const squadDiv = document.getElementById('club-tab-squad');
    const trophiesDiv = document.getElementById('club-tab-trophies');
    const newsDiv = document.getElementById('club-tab-news');
    const btns = document.querySelectorAll('.club-tab-btn');
    
    btns.forEach(btn => {
        btn.style.color = '#888';
        btn.style.borderBottomColor = 'transparent';
    });
    
    if (event && event.target) {
        event.target.style.color = 'white';
        event.target.style.borderBottomColor = '#00aaff';
    }
    
    aboutDiv.style.display = tab === 'about' ? 'block' : 'none';
    tableDiv.style.display = tab === 'table' ? 'block' : 'none';
    meczDiv.style.display = tab === 'mecze' ? 'block' : 'none';
    statsDiv.style.display = tab === 'stats' ? 'block' : 'none';
    seasonsDiv.style.display = tab === 'seasons' ? 'block' : 'none';
    squadDiv.style.display = tab === 'squad' ? 'block' : 'none';
    trophiesDiv.style.display = tab === 'trophies' ? 'block' : 'none';
    newsDiv.style.display = tab === 'news' ? 'block' : 'none';
    
    if (tab === 'table') {
        displayClubTableContent();
    } else if (tab === 'mecze') {
        const clubId = parseInt(document.querySelector('[data-club-id]')?.getAttribute('data-club-id') || '2');
        displayClubMatches(clubId);
    } else if (tab === 'seasons') {
        displayClubSeasons();
    } else if (tab === 'squad') {
        displayClubSquad();
    } else if (tab === 'trophies') {
        displayClubTrophies();
    } else if (tab === 'news') {
        displayClubNews();
    }
}

function switchPlayerTab(tab, btn) {
    const tabs = btn.parentElement.querySelectorAll('.player-tab');
    tabs.forEach(t => {
        t.classList.remove('active');
        t.style.color = '#888';
        t.style.borderBottomColor = 'transparent';
    });
    btn.classList.add('active');
    btn.style.color = 'white';
    btn.style.borderBottomColor = '#00aaff';
    
    const strikersContent = document.getElementById('strikers-content');
    const assistsContent = document.getElementById('assists-content');
    
    if (tab === 'strzelcy') {
        if (strikersContent) strikersContent.style.display = 'grid';
        if (assistsContent) assistsContent.style.display = 'none';
    } else if (tab === 'asysty') {
        if (strikersContent) strikersContent.style.display = 'none';
        if (assistsContent) assistsContent.style.display = 'grid';
    }
}

function switchStatsType(type, btn) {
    const tabs = btn.parentElement.querySelectorAll('.stats-type-tab');
    tabs.forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    
    const indywidualne = document.getElementById('stats-indywidualne');
    const druzynowe = document.getElementById('stats-druzynowe');
    
    if (type === 'indywidualne') {
        if (indywidualne) indywidualne.style.display = 'block';
        if (druzynowe) druzynowe.style.display = 'none';
    } else if (type === 'druzynowe') {
        if (indywidualne) indywidualne.style.display = 'none';
        if (druzynowe) druzynowe.style.display = 'block';
    }
}

function switchPlayerType(type, btn) {
    const tabs = btn.parentElement.querySelectorAll('.player-type-btn');
    tabs.forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
}

function showClubsView() {
    const allViews = document.querySelectorAll('[id$="-view"]');
    allViews.forEach(view => view.style.display = 'none');
    
    const clubsView = document.getElementById('clubs-view');
    if (clubsView) {
        clubsView.style.display = 'grid';
        loadClubsGallery();
    }
    
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => item.classList.remove('active'));
}

function showLeagueStats() {
    const allViews = document.querySelectorAll('[id$="-view"]');
    allViews.forEach(view => view.style.display = 'none');
    
    const leagueStatsView = document.getElementById('league-stats-view');
    const container = document.getElementById('league-stats-content');
    
    if (!leagueStatsView || !container) return;
    
    leagueStatsView.style.display = 'block';
    
    container.innerHTML = `
        <div class="league-stats-container">
            <h1 style="color: white; margin-bottom: 2rem; text-transform: uppercase; letter-spacing: 2px;">STATYSTYKI</h1>
            
            <div class="search-bar-container">
                <input type="text" id="player-search" class="player-search-input" placeholder="Wyszukaj zawodnika..." onkeyup="filterPlayers()">
                <div id="search-results" class="search-results"></div>
            </div>
            
            <div class="stats-tabs">
                <button class="stats-tab-btn active" onclick="switchStatsTab('indywidualne')">INDYWIDUALNE</button>
                <button class="stats-tab-btn" onclick="switchStatsTab('druzynowe')">DRU≈ªYNOWE</button>
            </div>
            
            <div id="indywidualne-stats" class="stats-tab-content">
                <div class="stats-type-buttons">
                    <button class="stats-type-btn active" onclick="switchPlayerType('pola')">ZAWODNICY Z POLA</button>
                    <button class="stats-type-btn" onclick="switchPlayerType('bramkarze')">BRAMKARZE</button>
                </div>
                
                <div id="pola-stats" class="stats-columns">
                    <div class="stats-column">
                        <div class="stats-column-header">KLASYFIKACJA STRZELC√ìW</div>
                        <div id="scorers-list" class="stats-players-list"></div>
                        <div class="stats-more"><a href="#">WIƒòCEJ ‚Üí</a></div>
                    </div>
                    
                    <div class="stats-column">
                        <div class="stats-column-header">ASYSTENCI</div>
                        <div id="assists-list" class="stats-players-list"></div>
                        <div class="stats-more"><a href="#">WIƒòCEJ ‚Üí</a></div>
                    </div>
                    
                    <div class="stats-column">
                        <div class="stats-column-header">KLASYFIKACJA KANADYJSKA</div>
                        <div id="canadian-list" class="stats-players-list"></div>
                        <div class="stats-more"><a href="#">WIƒòCEJ ‚Üí</a></div>
                    </div>
                </div>
                
                <div id="bramkarze-stats" class="stats-columns" style="display: none;">
                    <div class="stats-column">
                        <div class="stats-column-header">NAJMNIEJ STRACONYCH BRAMEK</div>
                        <div id="gk-list" class="stats-players-list"></div>
                    </div>
                </div>
            </div>
            
            <div id="druzynowe-stats" class="stats-tab-content" style="display: none;">
                <p style="color: #aaa; text-align: center; margin-top: 2rem;">Statystyki dru≈ºynowe wkr√≥tce</p>
            </div>
        </div>
    `;
    
    populateLeagueStats();
    
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => item.classList.remove('active'));
    document.getElementById('nav-stats').classList.add('active');
}

function switchStatsTab(tab) {
    document.querySelectorAll('.stats-tab-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('indywidualne-stats').style.display = tab === 'indywidualne' ? 'block' : 'none';
    document.getElementById('druzynowe-stats').style.display = tab === 'druzynowe' ? 'block' : 'none';
}

function switchPlayerType(type) {
    document.querySelectorAll('.stats-type-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('pola-stats').style.display = type === 'pola' ? 'block' : 'none';
    document.getElementById('bramkarze-stats').style.display = type === 'bramkarze' ? 'block' : 'none';
}

function populateLeagueStats() {
    const polacy = zawodnicy.filter(p => p.pozycja !== 'Bramkarz');
    const bramkarze = zawodnicy.filter(p => p.pozycja === 'Bramkarz');
    
    const topScorers = [...polacy].sort((a, b) => b.gole - a.gole);
    const topAssists = [...polacy].sort((a, b) => b.asysty - a.asysty);
    const topCanadian = [...polacy].sort((a, b) => (b.gole + b.asysty) - (a.gole + a.asysty));
    
    renderTopScorers(topScorers);
    renderTopAssists(topAssists);
    renderTopCanadian(topCanadian);
}

function renderTopScorers(scorers) {
    const container = document.getElementById('scorers-list');
    const topPlayer = scorers[0];
    const restPlayers = scorers.slice(1, 4);
    const klub = druzyny.find(d => d.id === topPlayer.klub);
    
    let html = `
        <div class="stats-top-player">
            <div class="stats-top-player-name">${topPlayer.imie.toUpperCase()} ${topPlayer.nazwisko.toUpperCase()}</div>
            <div class="stats-top-player-number">${topPlayer.gole}</div>
            <div class="stats-top-player-team">
                <img src="${klub?.logo}" alt="${klub?.nazwa}" style="width: 40px; height: 40px; object-fit: contain;">
            </div>
        </div>
    `;
    
    restPlayers.forEach((player, idx) => {
        const playerKlub = druzyny.find(d => d.id === player.klub);
        html += `
            <div class="stats-player-row" onclick="openPlayerModal(${player.id})">
                <span class="stats-rank">${idx + 2}</span>
                <span class="stats-player-name">${player.imie} ${player.nazwisko}</span>
                <span class="stats-value">${player.gole}</span>
                <img src="${playerKlub?.logo}" alt="${playerKlub?.nazwa}" class="stats-club-icon">
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function renderTopAssists(assists) {
    const container = document.getElementById('assists-list');
    const topPlayer = assists[0];
    const restPlayers = assists.slice(1, 4);
    const klub = druzyny.find(d => d.id === topPlayer.klub);
    
    let html = `
        <div class="stats-top-player">
            <div class="stats-top-player-name">${topPlayer.imie.toUpperCase()} ${topPlayer.nazwisko.toUpperCase()}</div>
            <div class="stats-top-player-number">${topPlayer.asysty}</div>
            <div class="stats-top-player-team">
                <img src="${klub?.logo}" alt="${klub?.nazwa}" style="width: 40px; height: 40px; object-fit: contain;">
            </div>
        </div>
    `;
    
    restPlayers.forEach((player, idx) => {
        const playerKlub = druzyny.find(d => d.id === player.klub);
        html += `
            <div class="stats-player-row" onclick="openPlayerModal(${player.id})">
                <span class="stats-rank">${idx + 2}</span>
                <span class="stats-player-name">${player.imie} ${player.nazwisko}</span>
                <span class="stats-value">${player.asysty}</span>
                <img src="${playerKlub?.logo}" alt="${playerKlub?.nazwa}" class="stats-club-icon">
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function renderTopCanadian(canadian) {
    const container = document.getElementById('canadian-list');
    const topPlayer = canadian[0];
    const restPlayers = canadian.slice(1, 4);
    const klub = druzyny.find(d => d.id === topPlayer.klub);
    
    let html = `
        <div class="stats-top-player">
            <div class="stats-top-player-name">${topPlayer.imie.toUpperCase()} ${topPlayer.nazwisko.toUpperCase()}</div>
            <div class="stats-top-player-number">${topPlayer.gole + topPlayer.asysty}</div>
            <div class="stats-top-player-team">
                <img src="${klub?.logo}" alt="${klub?.nazwa}" style="width: 40px; height: 40px; object-fit: contain;">
            </div>
        </div>
    `;
    
    restPlayers.forEach((player, idx) => {
        const playerKlub = druzyny.find(d => d.id === player.klub);
        html += `
            <div class="stats-player-row" onclick="openPlayerModal(${player.id})">
                <span class="stats-rank">${idx + 2}</span>
                <span class="stats-player-name">${player.imie} ${player.nazwisko}</span>
                <span class="stats-value">${player.gole + player.asysty}</span>
                <img src="${playerKlub?.logo}" alt="${playerKlub?.nazwa}" class="stats-club-icon">
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function openPlayerModal(playerId) {
    const player = zawodnicy.find(p => p.id === playerId);
    if (!player) return;
    
    const klub = druzyny.find(d => d.id === player.klub);
    const modal = document.getElementById('player-modal');
    const modalBody = document.getElementById('player-modal-body');
    
    const robloxId = player.profil.split('/users/')[1].split('/')[0];
    const avatarUrl = `https://www.roblox.com/bust-thumbnail/image?userId=${robloxId}&width=420&height=420&format=png`;
    
    modalBody.innerHTML = `
        <div class="player-profile-content">
            <div class="player-profile-header">
                <img src="${avatarUrl}" alt="${player.imie} ${player.nazwisko}" class="player-avatar" onerror="this.onerror=null; this.src='https://tr.rbxcdn.com/9f3e6c94f45fb5fa3b9e7a34c4a6d6a3/420x420.png'" loading="lazy">
            </div>
            
            <div class="player-profile-info">
                <h2>${player.imie} ${player.nazwisko}</h2>
                <div class="player-profile-bio">
                    <div class="player-bio-item">
                        <span class="player-bio-label">KLUB</span>
                        <span class="player-bio-value">${klub?.nazwa}</span>
                    </div>
                    <div class="player-bio-item">
                        <span class="player-bio-label">POZYCJA</span>
                        <span class="player-bio-value">${player.pozycja}</span>
                    </div>
                </div>
                
                <div class="player-stats-grid">
                    <div class="player-stat">
                        <div class="player-stat-value">${player.gole}</div>
                        <div class="player-stat-label">GOLE</div>
                    </div>
                    <div class="player-stat">
                        <div class="player-stat-value">${player.asysty}</div>
                        <div class="player-stat-label">ASYSTY</div>
                    </div>
                    <div class="player-stat">
                        <div class="player-stat-value">${player.gole + player.asysty}</div>
                        <div class="player-stat-label">RAZEM</div>
                    </div>
                </div>
                
                <a href="${player.profil}" target="_blank" class="player-profile-link">Odwied≈∫ Profil Roblox ‚Üí</a>
            </div>
        </div>
    `;
    
    modal.style.display = 'block';
}

function closePlayerModal() {
    document.getElementById('player-modal').style.display = 'none';
}

function filterPlayers() {
    const searchInput = document.getElementById('player-search');
    const searchTerm = searchInput.value.toLowerCase();
    const searchResults = document.getElementById('search-results');
    
    if (!searchTerm) {
        searchResults.innerHTML = '';
        searchResults.style.display = 'none';
        return;
    }
    
    const results = zawodnicy.filter(p => 
        p.imie.toLowerCase().includes(searchTerm) || 
        p.nazwisko.toLowerCase().includes(searchTerm) ||
        (p.robloxName && p.robloxName.toLowerCase().includes(searchTerm))
    );
    
    if (results.length > 0) {
        searchResults.innerHTML = results.map(p => `
            <div class="search-result-item" onclick="openDetailedPlayerProfile(${p.id})">
                <div class="search-result-name">${p.imie} ${p.nazwisko}</div>
                ${p.robloxName ? `<div class="search-result-roblox">${p.robloxName}</div>` : ''}
            </div>
        `).join('');
        searchResults.style.display = 'block';
    } else {
        searchResults.innerHTML = '<div class="search-result-item">Brak wynik√≥w</div>';
        searchResults.style.display = 'block';
    }
}

function filterPlayersNavbar() {
    const searchInput = document.getElementById('navbar-player-search');
    const searchTerm = searchInput.value.toLowerCase();
    const searchResults = document.getElementById('navbar-search-results');
    
    if (!searchTerm) {
        searchResults.innerHTML = '';
        searchResults.style.display = 'none';
        return;
    }
    
    const results = zawodnicy.filter(p => 
        p.imie.toLowerCase().includes(searchTerm) || 
        p.nazwisko.toLowerCase().includes(searchTerm) ||
        (p.robloxName && p.robloxName.toLowerCase().includes(searchTerm))
    );
    
    if (results.length > 0) {
        searchResults.innerHTML = results.map(p => `
            <div class="search-result-item" onclick="openDetailedPlayerProfile(${p.id})">
                <div class="search-result-name">${p.imie} ${p.nazwisko}</div>
                ${p.robloxName ? `<div class="search-result-roblox">${p.robloxName}</div>` : ''}
            </div>
        `).join('');
        searchResults.style.display = 'block';
    } else {
        searchResults.innerHTML = '<div class="search-result-item">Brak wynik√≥w</div>';
        searchResults.style.display = 'block';
    }
}

function openDetailedPlayerProfile(playerId) {
    const player = zawodnicy.find(p => p.id === playerId);
    if (!player) return;
    
    const klub = druzyny.find(d => d.id === player.klub);
    const modal = document.getElementById('player-modal');
    const modalBody = document.getElementById('player-modal-body');
    
    const robloxId = player.profil.split('/users/')[1].split('/')[0];
    const avatarUrl = `https://www.roblox.com/bust-thumbnail/image?userId=${robloxId}&width=420&height=420&format=png`;
    const displayName = player.robloxName || player.nazwisko;
    
    modalBody.innerHTML = `
        <div class="detailed-player-profile">
            <div class="detailed-player-header" style="background: linear-gradient(135deg, #0056b3, #00aaff); padding: 2rem; border-radius: 8px 8px 0 0; display: flex; gap: 2.5rem; align-items: center;">
                <div style="flex-shrink: 0;">
                    <img src="${avatarUrl}" alt="${player.imie} ${player.nazwisko}" style="width: 200px; height: 200px; border-radius: 12px; border: 4px solid white; object-fit: cover;" onerror="this.onerror=null; this.src='https://tr.rbxcdn.com/9f3e6c94f45fb5fa3b9e7a34c4a6d6a3/420x420.png'" loading="lazy">
                </div>
                <div style="color: white; flex: 1; display: flex; flex-direction: column; justify-content: center;">
                    <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1rem;">
                        <div>
                            <div style="font-size: 2.5rem; font-weight: bold; text-transform: uppercase; line-height: 1.2;">${player.imie}</div>
                            <div style="font-size: 2.5rem; font-weight: bold; text-transform: uppercase; line-height: 1.2; color: #00aaff;">${displayName}</div>
                        </div>
                        <img src="${klub?.logo}" alt="${klub?.nazwa}" style="height: 100px; width: auto; max-width: 150px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.3));">
                    </div>
                    <div style="font-size: 0.95rem; opacity: 0.95; margin-bottom: 0.5rem;">Pozycja: <strong>${player.pozycja}</strong></div>
                    <div style="font-size: 0.95rem; opacity: 0.95;">Klub: <strong>${klub?.nazwa}</strong></div>
                </div>
            </div>
            
            <div class="detailed-player-bio" style="background: rgba(0, 0, 0, 0.2); padding: 1.5rem; display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; border-bottom: 2px solid #0056b3;">
                <div style="border-right: 1px solid #0056b3; padding-right: 1rem;">
                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 0.3rem;">IMƒò</div>
                    <div style="color: white; font-weight: bold;">${player.imie}</div>
                </div>
                <div style="border-right: 1px solid #0056b3; padding-right: 1rem;">
                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 0.3rem;">NICK</div>
                    <div style="color: white; font-weight: bold;">${displayName}</div>
                </div>
                <div>
                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 0.3rem;">KRAJ</div>
                    <div style="color: white; font-weight: bold;">${player.kraj || 'N/A'}</div>
                </div>
                <div style="border-right: 1px solid #0056b3; padding-right: 1rem; border-top: 1px solid #0056b3; padding-top: 1rem; margin-top: 1rem;">
                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 0.3rem;">POZYCJA</div>
                    <div style="color: white; font-weight: bold;">${player.pozycja}</div>
                </div>
                <div style="border-right: 1px solid #0056b3; padding-right: 1rem; border-top: 1px solid #0056b3; padding-top: 1rem; margin-top: 1rem;">
                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 0.3rem;">WZROST</div>
                    <div style="color: white; font-weight: bold;">185 cm</div>
                </div>
                <div style="border-top: 1px solid #0056b3; padding-top: 1rem; margin-top: 1rem;">
                    <div style="color: #aaa; font-size: 0.8rem; margin-bottom: 0.3rem;">DATA URODZENIA</div>
                    <div style="color: white; font-weight: bold;">${player.dataUrodzenia || '1996-03-06'}</div>
                </div>
            </div>
            
            <div class="detailed-stats-grid" style="padding: 2rem; display: grid; grid-template-columns: repeat(6, 1fr); gap: 1.5rem;">
                <div style="text-align: center;">
                    <div style="font-size: 1.8rem; color: #00aaff; font-weight: bold;">${player.gole + player.asysty}</div>
                    <div style="color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Mecze Rozegrane</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.8rem; color: #00aaff; font-weight: bold;">${player.gole + player.asysty}</div>
                    <div style="color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Mecze w podstawowym sk≈Çadzie</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.8rem; color: #00aaff; font-weight: bold;">${player.gole}</div>
                    <div style="color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Gole</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.8rem; color: #00aaff; font-weight: bold;">${player.asysty}</div>
                    <div style="color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Asysty</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.8rem; color: #00aaff; font-weight: bold;">${player.gole + player.asysty}</div>
                    <div style="color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Klasyfikacja Kanadyjska</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.8rem; color: #00aaff; font-weight: bold;">1</div>
                    <div style="color: #aaa; font-size: 0.8rem; text-transform: uppercase;">Kluczowy udzia≈Ç bez asysty</div>
                </div>
            </div>
            
            <div style="padding: 1.5rem; text-align: center;">
                <a href="${player.profil}" target="_blank" class="player-profile-link">Odwied≈∫ Profil Roblox ‚Üí</a>
            </div>
        </div>
    `;
    
    const playerSearch = document.getElementById('player-search');
    const navbarSearch = document.getElementById('navbar-player-search');
    if (playerSearch) {
        playerSearch.value = '';
        document.getElementById('search-results').innerHTML = '';
        document.getElementById('search-results').style.display = 'none';
    }
    if (navbarSearch) {
        navbarSearch.value = '';
        document.getElementById('navbar-search-results').innerHTML = '';
        document.getElementById('navbar-search-results').style.display = 'none';
    }
    
    modal.style.display = 'block';
}

const cupBracketData = [
    { id: 1, home: { id: 2, nazwa: 'Legia Warszawa', skrot: 'LEG', logo: 'https://upload.wikimedia.org/wikipedia/commons/a/a4/Legia_Warsaw_logo.png' }, away: { id: 5, nazwa: 'Lech Pozna≈Ñ', skrot: 'LPO', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/b/b0/KKS_Lech_Pozna%C5%84.svg/960px-KKS_Lech_Pozna%C5%84.svg.png' }, homeScore: 2, awayScore: 1, status: 'finished' },
    { id: 2, home: { id: 3, nazwa: 'Pogo≈Ñ Szczecin', skrot: 'POG', logo: 'https://pogoncdn.stellis.one/imgsize-xs/documents/7740889/44a6ff9f-f346-69e6-890c-c6f10c6e891b' }, away: { id: 4, nazwa: 'Arka Gdynia', skrot: 'ARK', logo: 'https://arka.gdynia.pl/files/herb/arka_gdynia_mzks_kolor.png' }, homeScore: 3, awayScore: 2, status: 'finished' },
    { id: 3, home: { id: 7, nazwa: 'Lechia Gda≈Ñsk', skrot: 'LGD', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/b/b7/Lechia_Gda%C5%84sk_logo.svg/1200px-Lechia_Gda%C5%84sk_logo.svg.png' }, away: { id: 8, nazwa: 'Zag≈Çƒôbie Lubin', skrot: 'ZAG', logo: 'https://upload.wikimedia.org/wikipedia/en/thumb/2/20/Zag%C5%82%C4%99bie_Lubin_crest.svg/1200px-Zag%C5%82%C4%99bie_Lubin_crest.svg.png' }, homeScore: 0, awayScore: 2, status: 'finished' },
    { id: 4, home: { id: 6, nazwa: 'Zawisza Bydgoszcz', skrot: 'ZAW', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/55/Herb_Zawiszy_Bydgoszcz.png' }, away: { id: 1, nazwa: 'Unia Sienkiewicze', skrot: 'USI', logo: 'https://uniaskierniewice.pl/_next/image?url=%2Fimages%2Flogo%2Funia_logo-300x300.png&w=384&q=75' }, homeScore: 1, awayScore: 0, status: 'finished' },
    { id: 5, home: { id: 100, nazwa: 'G√≥rnik ≈Åƒôczna', skrot: 'GLZ', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/G%C3%B3rnik_%C5%81%C4%99czna_logo.png/1200px-G%C3%B3rnik_%C5%81%C4%99czna_logo.png' }, away: { id: 101, nazwa: 'Widzew ≈Å√≥d≈∫', skrot: 'WID', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Widzew_L%C3%B3d%C5%BA_logo.svg/1200px-Widzew_L%C3%B3d%C5%BA_logo.svg.png' }, homeScore: 1, awayScore: 2, status: 'finished' },
    { id: 6, home: { id: 102, nazwa: 'Podbeskidzie Tychy', skrot: 'POT', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Podbeskidzie_Tychy_herb.svg/1200px-Podbeskidzie_Tychy_herb.svg.png' }, away: { id: 103, nazwa: 'Resovia Rzesz√≥w', skrot: 'RES', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e9/Resovia_Rzeszow.svg/1200px-Resovia_Rzeszow.svg.png' }, homeScore: 0, awayScore: 1, status: 'finished' },
    { id: 7, home: { id: 104, nazwa: 'Olimpia GrudziƒÖdz', skrot: 'OLI', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Olimpia_Grudziadz_herb.svg/1200px-Olimpia_Grudziadz_herb.svg.png' }, away: { id: 105, nazwa: 'Chrobry G≈Çog√≥w', skrot: 'CHR', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Chrobry_Glogov_herb.svg/1200px-Chrobry_Glogov_herb.svg.png' }, homeScore: 2, awayScore: 2, status: 'finished' },
    { id: 8, home: { id: 106, nazwa: 'GKS Jastrzƒôbie', skrot: 'GKS', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/b/b9/GKS_Jastrzebie_herb.svg/1200px-GKS_Jastrzebie_herb.svg.png' }, away: { id: 107, nazwa: 'MKS Kalisz', skrot: 'MKS', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/MKS_Kalisz_herb.svg/1200px-MKS_Kalisz_herb.svg.png' }, homeScore: 3, awayScore: 1, status: 'finished' }
];

function renderCupBracket() {
    const container = document.getElementById('bracket-content');
    if (!container) return;
    
    const quarterFinals = [
        { id: 1, home: cupBracketData[0].homeScore > cupBracketData[0].awayScore ? cupBracketData[0].home : cupBracketData[0].away, away: null, homeScore: null, awayScore: null },
        { id: 2, home: cupBracketData[1].homeScore > cupBracketData[1].awayScore ? cupBracketData[1].home : cupBracketData[1].away, away: null, homeScore: null, awayScore: null },
        { id: 3, home: cupBracketData[2].homeScore > cupBracketData[2].awayScore ? cupBracketData[2].home : cupBracketData[2].away, away: null, homeScore: null, awayScore: null },
        { id: 4, home: cupBracketData[3].homeScore > cupBracketData[3].awayScore ? cupBracketData[3].home : cupBracketData[3].away, away: null, homeScore: null, awayScore: null }
    ];
    
    const semiFinals = [
        { id: 1, home: quarterFinals[0].home, away: quarterFinals[1].home, homeScore: null, awayScore: null },
        { id: 2, home: quarterFinals[2].home, away: quarterFinals[3].home, homeScore: null, awayScore: null }
    ];
    
    function renderTeamBox(team, score = null, isSmall = false) {
        if (!team) {
            return `<div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(100, 100, 100, 0.1); border-radius: 3px; height: ${isSmall ? '35px' : '40px'}; opacity: 0.5;">
                <div style="color: #555; font-size: 0.7rem;">-</div>
            </div>`;
        }
        
        const height = isSmall ? '35px' : '40px';
        const fontSize = isSmall ? '0.75rem' : '0.85rem';
        
        return `<div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: rgba(0, 170, 255, 0.05); border: 1px solid rgba(0, 170, 255, 0.2); border-radius: 3px; height: ${height};">
            <img src="${team.logo}" alt="${team.nazwa}" style="width: 24px; height: 24px; object-fit: contain;">
            <span style="color: white; font-weight: bold; font-size: ${fontSize}; min-width: 35px;">${team.skrot}</span>
            ${score !== null ? `<span style="color: white; font-weight: bold; margin-left: auto; min-width: 20px; text-align: center;">${score}</span>` : ''}
        </div>`;
    }
    
    let html = `<div style="display: flex; gap: 3rem; justify-content: space-between; overflow-x: auto; padding: 2rem; align-items: flex-start;">
        <!-- 1/8 Fina≈Çu -->
        <div style="display: flex; flex-direction: column; gap: 1.5rem; min-width: 180px;">
            <div style="color: #888; font-size: 0.9rem; text-align: center; margin-bottom: 0.5rem;">1/8 FINA≈ÅU</div>`;
    
    cupBracketData.forEach((match, idx) => {
        html += `
            <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 170, 255, 0.15); border-radius: 4px; padding: 0.6rem; min-width: 160px;">
                ${renderTeamBox(match.home, match.homeScore, false)}
                <div style="height: 0.5rem;"></div>
                ${renderTeamBox(match.away, match.awayScore, false)}
            </div>
        `;
    });
    
    html += `</div>
        
        <!-- 1/4 Fina≈Çu -->
        <div style="display: flex; flex-direction: column; gap: 4.2rem; min-width: 180px;">
            <div style="color: #888; font-size: 0.9rem; text-align: center; margin-bottom: 0.5rem;">1/4 FINA≈ÅU</div>`;
    
    quarterFinals.forEach((match, idx) => {
        html += `
            <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 170, 255, 0.15); border-radius: 4px; padding: 0.6rem; min-width: 160px;">
                ${renderTeamBox(match.home, match.homeScore, true)}
                <div style="height: 0.3rem;"></div>
                ${renderTeamBox(null, null, true)}
            </div>
        `;
    });
    
    html += `</div>
        
        <!-- 1/2 Fina≈Çu -->
        <div style="display: flex; flex-direction: column; gap: 8.5rem; min-width: 180px;">
            <div style="color: #888; font-size: 0.9rem; text-align: center; margin-bottom: 0.5rem;">1/2 FINA≈ÅU</div>`;
    
    semiFinals.forEach((match, idx) => {
        html += `
            <div style="background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 170, 255, 0.15); border-radius: 4px; padding: 0.6rem; min-width: 160px;">
                ${renderTeamBox(match.home, match.homeScore, true)}
                <div style="height: 0.3rem;"></div>
                ${renderTeamBox(match.away, match.awayScore, true)}
            </div>
        `;
    });
    
    html += `</div>
    </div>`;
    
    container.innerHTML = html;
}
